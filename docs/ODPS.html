<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>阿里云 ODPS 笔记 | 不可思议</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="xchenhao.gitee.io">
    <link rel="preload" href="/assets/css/0.styles.dcdd4981.css" as="style"><link rel="preload" href="/assets/js/app.d27ffea8.js" as="script"><link rel="preload" href="/assets/js/3.e8b8d8a4.js" as="script"><link rel="preload" href="/assets/js/17.3214180a.js" as="script"><link rel="prefetch" href="/assets/js/10.2e637e9f.js"><link rel="prefetch" href="/assets/js/11.337b06bc.js"><link rel="prefetch" href="/assets/js/12.27811774.js"><link rel="prefetch" href="/assets/js/13.5f093fae.js"><link rel="prefetch" href="/assets/js/14.1a82e8e9.js"><link rel="prefetch" href="/assets/js/15.a64b3072.js"><link rel="prefetch" href="/assets/js/16.cf7c36d7.js"><link rel="prefetch" href="/assets/js/18.edf3cc3a.js"><link rel="prefetch" href="/assets/js/19.4c511e27.js"><link rel="prefetch" href="/assets/js/20.93e8e7ba.js"><link rel="prefetch" href="/assets/js/21.43f36607.js"><link rel="prefetch" href="/assets/js/22.84c0f4d0.js"><link rel="prefetch" href="/assets/js/23.69a9d3d6.js"><link rel="prefetch" href="/assets/js/24.5a154f6d.js"><link rel="prefetch" href="/assets/js/25.457bbc59.js"><link rel="prefetch" href="/assets/js/26.33e882f8.js"><link rel="prefetch" href="/assets/js/27.57ebc4ca.js"><link rel="prefetch" href="/assets/js/28.9995b9d4.js"><link rel="prefetch" href="/assets/js/29.fb93f325.js"><link rel="prefetch" href="/assets/js/30.44302397.js"><link rel="prefetch" href="/assets/js/31.1211134a.js"><link rel="prefetch" href="/assets/js/32.a0a27db3.js"><link rel="prefetch" href="/assets/js/33.487dd495.js"><link rel="prefetch" href="/assets/js/34.25c0e68c.js"><link rel="prefetch" href="/assets/js/35.9810a2aa.js"><link rel="prefetch" href="/assets/js/4.4ac29603.js"><link rel="prefetch" href="/assets/js/5.db7cab44.js"><link rel="prefetch" href="/assets/js/6.9f3e728c.js"><link rel="prefetch" href="/assets/js/7.6a2e5068.js"><link rel="prefetch" href="/assets/js/8.b8da02e2.js"><link rel="prefetch" href="/assets/js/9.139e0367.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.40e3c389.js">
    <link rel="stylesheet" href="/assets/css/0.styles.dcdd4981.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="sidebar-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="/" class="router-link-active no-logo home-link"><!----> <span class="site-name">不可思议</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          数据库
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          语言
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <!----></nav></div></div> <!----></header> <aside class="sidebar"><!----> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>数据库</span> <span class="arrow down"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Hive.html" title="Hive" class="sidebar-link">Hive</a></li><li><a href="/ODPS.html" aria-current="page" title="ODPS" class="active sidebar-link">ODPS</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/mongodb/MongoBasis.html" title="MongoDB 基础" class="sidebar-link">MongoDB 基础</a></li><li><a href="/mongodb/MongoBegin.html" title="MongoDB 起步" class="sidebar-link">MongoDB 起步</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MySQL</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>语言</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其它</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><a href="/books-note.html" title="读书笔记" class="sidebar-link">读书笔记</a></li><li><a href="/update_log.html" title="更新记录" class="sidebar-link">更新记录</a></li></ul></aside> <main class="page"> <div class="theme-antdocs-content content__default"><h3 id="阿里云-odps-笔记"><a href="#阿里云-odps-笔记" class="header-anchor">#</a> 阿里云 ODPS 笔记</h3> <h3 id="odps"><a href="#odps" class="header-anchor">#</a> ODPS</h3> <ul><li>Open Data Processing Service</li> <li>ODPS SQL 与 Hive SQL 语法基本一致，语法是标准语法 ANSI SQL92 的一个子集，并有自己的扩展</li></ul> <h3 id="创建表"><a href="#创建表" class="header-anchor">#</a> 创建表</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 表名与列名均无所谓大小写</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span> table_name
 <span class="token punctuation">[</span><span class="token punctuation">(</span>col_name data_type <span class="token punctuation">[</span><span class="token keyword">COMMENT</span> col_comment<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token punctuation">[</span><span class="token keyword">COMMENT</span> table_comment<span class="token punctuation">]</span>
 <span class="token punctuation">[</span>PARTITIONED <span class="token keyword">BY</span> <span class="token punctuation">(</span>col_name data_type <span class="token punctuation">[</span><span class="token keyword">COMMENT</span> col_comment<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">-- 分区表：根据各分区的LastDataModifiedTime判断该分区是否该被回收。</span>
<span class="token comment">-- 不同于非分区表，分区表的最后一个分区被回收后，该表不会被删除。</span>

<span class="token comment">-- 生命周期只能设定到表级别，不能在分区级设置生命周期。</span>
<span class="token comment">-- days参数为生命周期时间，只接受正整数。单位：天。</span>
 <span class="token punctuation">[</span>LIFECYCLE days<span class="token punctuation">]</span>
 <span class="token punctuation">[</span><span class="token keyword">AS</span> select_statement<span class="token punctuation">]</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span> table_name
 <span class="token operator">LIKE</span> existing_table_name
</code></pre></div><h4 id="示例"><a href="#示例" class="header-anchor">#</a> 示例</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> sale_detail<span class="token punctuation">(</span>
      shop_name     STRING<span class="token punctuation">,</span>
      customer_id   STRING<span class="token punctuation">,</span>
      total_price   <span class="token keyword">DOUBLE</span><span class="token punctuation">)</span>
PARTITIONED <span class="token keyword">BY</span> <span class="token punctuation">(</span>sale_date STRING<span class="token punctuation">,</span>region STRING<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 添加分区</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> sale_detail <span class="token keyword">add</span> <span class="token keyword">partition</span> <span class="token punctuation">(</span>sale_date<span class="token operator">=</span><span class="token string">'201312'</span><span class="token punctuation">,</span> region<span class="token operator">=</span><span class="token string">'hangzhou'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="查看分区"><a href="#查看分区" class="header-anchor">#</a> 查看分区</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DESC</span> meta<span class="token punctuation">.</span>m_security_users <span class="token keyword">partition</span> <span class="token punctuation">(</span>ds<span class="token operator">=</span><span class="token string">'20191224'</span><span class="token punctuation">)</span>

<span class="token keyword">SHOW</span> PARTITIONS m_security_users<span class="token punctuation">;</span>
</code></pre></div><h3 id="查询"><a href="#查询" class="header-anchor">#</a> 查询</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">READ</span> tableName <span class="token keyword">PARTITION</span> <span class="token punctuation">(</span>partitionName <span class="token operator">=</span> <span class="token string">'xxx'</span><span class="token punctuation">)</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="select"><a href="#select" class="header-anchor">#</a> SELECT</h4> <ul><li>SELECT 分区表时禁止全表扫描（需指定分区）</li> <li>实在需全表扫描：</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SET</span> odps<span class="token punctuation">.</span><span class="token keyword">sql</span><span class="token punctuation">.</span>allow<span class="token punctuation">.</span>fullscan <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">-- 对分区表</span>

SETPROJECT odps<span class="token punctuation">.</span><span class="token keyword">sql</span><span class="token punctuation">.</span>allow<span class="token punctuation">.</span>fullscan <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">-- 对整个项目</span>
</code></pre></div><h3 id="更新-insert-语句"><a href="#更新-insert-语句" class="header-anchor">#</a> 更新（INSERT 语句）</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 注意与 MySQL 区别（有 TABLE 关键字）</span>

<span class="token keyword">INSERT</span> OVERWRITE<span class="token operator">|</span><span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> tablename <span class="token punctuation">[</span><span class="token keyword">PARTITION</span> <span class="token punctuation">(</span>partcol1<span class="token operator">=</span>val1<span class="token punctuation">,</span> partcol2<span class="token operator">=</span>val2 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>col1<span class="token punctuation">,</span>col2 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
select_statement
<span class="token keyword">FROM</span> from_statement<span class="token punctuation">;</span>
</code></pre></div><h4 id="示例-2"><a href="#示例-2" class="header-anchor">#</a> 示例</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 覆盖更新（不支持指定列）</span>
<span class="token keyword">INSERT</span> OVERWRITE <span class="token keyword">TABLE</span> a <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> b<span class="token punctuation">;</span>
<span class="token comment">-- 追加更新</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> a <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> b<span class="token punctuation">;</span>


<span class="token comment">-- 创建目标表sale_detail_insert。</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> sale_detail_insert <span class="token operator">like</span> sale_detail<span class="token punctuation">;</span>
<span class="token comment">-- 给目标表增加分区。</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> sale_detail_insert <span class="token keyword">add</span> <span class="token keyword">partition</span><span class="token punctuation">(</span>sale_date<span class="token operator">=</span><span class="token string">'2013'</span><span class="token punctuation">,</span> region<span class="token operator">=</span><span class="token string">'china'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 从源表sale_detail中取出数据插入目标表sale_detail_insert。</span>
<span class="token keyword">insert</span> overwrite <span class="token keyword">table</span> sale_detail_insert <span class="token keyword">partition</span> <span class="token punctuation">(</span>sale_date<span class="token operator">=</span><span class="token string">'2013'</span><span class="token punctuation">,</span> region<span class="token operator">=</span><span class="token string">'china'</span><span class="token punctuation">)</span>
  <span class="token keyword">select</span> shop_name<span class="token punctuation">,</span> customer_id<span class="token punctuation">,</span>total_price <span class="token keyword">from</span> sale_detail<span class="token punctuation">;</span>
</code></pre></div><h3 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h3> <ul><li>SQL概述 https://help.aliyun.com/document_detail/27860.html</li> <li>更新表数据 INSERT OVERWRITE|INSERT INTO  https://help.aliyun.com/document_detail/73775.html</li> <li>ODPS语句集锦 https://blog.csdn.net/b2222505/article/details/79978131</li> <li>基于ODPS的SQL语句 https://blog.csdn.net/dream_catcher_10/article/details/48826639</li> <li>如何理解maxcompute常见报错信息？https://blog.csdn.net/xstardust/article/details/81222555</li> <li>2.3 阿里云ODPS常用SQL操作 https://www.jianshu.com/p/ca4189482409</li> <li>2.2 阿里云ODPS常用命令总结 https://www.jianshu.com/p/65378f022edd</li> <li>2.1 阿里云ODPS数据上传与下载 https://www.jianshu.com/p/a88d72afb3f0</li> <li>相关
<ul><li>一文快速了解MaxCompute
https://blog.csdn.net/weixin_33696106/article/details/91484823</li> <li>阿里巴巴大数据计算平台MaxCompute（原名ODPS）全套攻略 https://blog.csdn.net/qq_36510261/article/details/78972037</li></ul></li></ul> <h3 id="记录"><a href="#记录" class="header-anchor">#</a> 记录</h3> <ul><li>2019/12/24 23:25 创建</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/23/2020, 1:32:19 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/Hive.html" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        Hive
      </a></span> <span class="next"><a href="/mongodb/MongoBasis.html">
        MongoDB 基础
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> </main> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d27ffea8.js" defer></script><script src="/assets/js/3.e8b8d8a4.js" defer></script><script src="/assets/js/17.3214180a.js" defer></script>
  </body>
</html>