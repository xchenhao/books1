(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{757:function(t,s,a){t.exports=a.p+"assets/img/image-20201205201011264.ee9154bc.png"},758:function(t,s,a){t.exports=a.p+"assets/img/image-20201205205142872.9c6fa174.png"},759:function(t,s,a){t.exports=a.p+"assets/img/image-20201212151159149.c7a5626d.png"},760:function(t,s,a){t.exports=a.p+"assets/img/image-20201212151227030.ae038cbd.png"},761:function(t,s,a){t.exports=a.p+"assets/img/image-20201212152524212.9025a0a6.png"},822:function(t,s,a){"use strict";a.r(s);var n=a(49),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h3",{attrs:{id:"存储引擎类问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#存储引擎类问题"}},[t._v("#")]),t._v(" 存储引擎类问题")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("说一说你了解的MySQL存储引擎及其适用场景")])]),t._v(" "),n("li",[n("p",[t._v("在什么情况下Innodb无法在线修改表结构？")])]),t._v(" "),n("li",[n("p",[t._v("在无法进行在线修改表结构的情况下，要如何操作？")])]),t._v(" "),n("li",[n("p",[t._v("InnoDB是如何实现事务的？")])]),t._v(" "),n("li",[n("p",[t._v("Innodb读操作是否会阻塞写操作？")])])]),t._v(" "),n("ul",[n("li",[n("p",[t._v("常用的MySQL存储引擎及使用场景")]),t._v(" "),n("p",[t._v("知识点")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("MySQL常用的存储引擎")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("引擎名称")]),t._v(" "),n("th",[t._v("事务")]),t._v(" "),n("th",[t._v("说明")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("MYISAM")]),t._v(" "),n("td",[t._v("N")]),t._v(" "),n("td",[t._v("MySQL5.6之前的默认引擎，最常用的非事务型存储引擎")])]),t._v(" "),n("tr",[n("td",[t._v("CSV")]),t._v(" "),n("td",[t._v("N")]),t._v(" "),n("td",[t._v("以CSV格式存储的非事务型存储引擎")])]),t._v(" "),n("tr",[n("td",[t._v("Archive")]),t._v(" "),n("td",[t._v("N")]),t._v(" "),n("td",[t._v("只允许查询和新增数据而不允许修改的非事务型存储引擎")])]),t._v(" "),n("tr",[n("td",[t._v("Memory")]),t._v(" "),n("td",[t._v("N")]),t._v(" "),n("td",[t._v("是一种易失性非事务型存储引擎")])]),t._v(" "),n("tr",[n("td",[t._v("INNODB")]),t._v(" "),n("td",[t._v("Y")]),t._v(" "),n("td",[t._v("最常用的事务型存储引擎")])]),t._v(" "),n("tr",[n("td",[t._v("NDB")]),t._v(" "),n("td",[t._v("Y")]),t._v(" "),n("td",[t._v("MySQL集群所使用的内存型事务存储引擎")])])])]),t._v(" "),n("ul",[n("li",[n("p",[t._v("MyISAM 的特点")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("非事务型存储引擎")])]),t._v(" "),n("li",[n("p",[t._v("以堆表方式存储")])]),t._v(" "),n("li",[n("p",[t._v("使用表级锁")])]),t._v(" "),n("li",[n("p",[t._v("支持Btree索引，空间索引，全文索引")])])]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("mysql"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" use stock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmysql"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" create table myIsam"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id int, c1 varchar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("engine")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("myisam"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmysql"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" check table myIsam"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n----------------------------------------\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("Table       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("Op     "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("Msg_Type"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("Msg_text"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("stock.myIsam"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("check  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("status  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("OK      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n----------------------------------------\nmysql"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" repair table myIsam"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n----------------------------------------\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("Table       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("Op     "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("Msg_Type"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("Msg_text"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("stock.myIsam"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("repair "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("status  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("OK      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n----------------------------------------\n")])])]),n("p",[n("img",{attrs:{src:a(757),alt:"image-20201205201011264"}})]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("$ myisampack --help "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可对 myisam 表压缩")]),t._v("\n$ myisampack -b -f myIsam\nCompressing myIsam. MYD: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" records"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nCalculating statistics\n-Compressing "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" \nEmpty "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" saved "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" compressed "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("format")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" -lh myIsam*\n-rw-r----- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" mysql mysql "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("   Aug "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(":33 myIsam. MYD\n-rw-r----- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" mysql mysql "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(".0K Aug "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(":33 myIsam. MYT\n-rw-r------1 mysql mysql "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    Aug "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(":33 myIsam.OLD\n-rw-r----- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" mysql mysql "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(".2K Aug "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(":33 myIsam_373.sdi\n")])])]),n("p",[t._v("适用场景")]),t._v(" "),n("ul",[n("li",[t._v("读操作远远大于写操作的场景")]),t._v(" "),n("li",[t._v("不需要使用事务的场景")])])]),t._v(" "),n("li",[n("p",[t._v("CSV 引擎的特点")]),t._v(" "),n("ol",[n("li",[t._v("非事务型存储引擎")]),t._v(" "),n("li",[t._v("数据以CSV格式存储")]),t._v(" "),n("li",[t._v("所有列都不能为NULL")]),t._v(" "),n("li",[t._v("不支持索引")])]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("mysql"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" create table mycsv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id int, c1 varchar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(",c2 char "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("engine")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("csv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nERROR "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1178")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("42000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": The storage engine "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the table doesn"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'t support nuilable columns\nmysql> create tabie mycsv(id int not null,c1 varchar(20) not nul1 ,c2 char(20) not null) engine=csV;\nQuery ok, o rows affected (0.02 sec)\nmysql> insert into mycsv values(1，'")]),t._v("aa"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'，'")]),t._v("bb"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'),(2，'")]),t._v("cc"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'，'")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("dd")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('\');\n\n\n[root@MysQL-06 stock]# 1s-1h mycsv*\n-rw-r-- 1 mysql mysql 35   Aug 30 21:43 mycsv.CSM\n-rw-r-- 1 mysql mysql 24   Aug 30 21:43 mycsv.CSV\n-rw-r-- 1 mysql mysql 3.OK Aug 30 21:42 mycsv_375.sdi\n[root@MysQL-06 stock] # more mycsv.CSV\n1,"aa", "bb"\n2, "cc","dd"\n[root@MysQL-06 stock] # echo \'')]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dd"')]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ee"')]),t._v("' "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" mycsv.CSV\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@MysQL-06 stock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# more mycsv.CSV")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"aa"')]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bb"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cc"')]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dd"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dd"')]),t._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ee"')]),t._v("\nmysql"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" * from mycsv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("----"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("----"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("----"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" c1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" c2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" aa "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" bb "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" cc "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("dd")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" ee "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("----"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("----"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("----"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" rows "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.00")]),t._v(" sec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nmysql"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" create index idx_id on mycsv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nERROR "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1069")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("42000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": Too many keys specified"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" max o keys allowed\n")])])]),n("p",[t._v("适用场景")]),t._v(" "),n("ul",[n("li",[t._v("做为数据交换的中间表使用")])])])]),t._v(" "),n("ul",[n("li",[n("p",[t._v("Archive 引擎的特点")]),t._v(" "),n("ol",[n("li",[t._v("非事务型存储引擎")]),t._v(" "),n("li",[t._v("表数据使用zlib压缩")]),t._v(" "),n("li",[t._v("只支持Insert和Select")]),t._v(" "),n("li",[t._v("只允许在自增ID上建立索引")])]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("mysql"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" create table myarchive"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id int auto_increment not null,c1 varchar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", c2 char"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(",key "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v("engine"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("archive"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[n("img",{attrs:{src:a(758),alt:"image-20201205205142872"}})]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("mysql"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" insert into myarchive"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c1, c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" values"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'aa'")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bb'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cc'")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dd'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmysql"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" delete from myarchive where "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nERROR "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1031")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HY000"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": Table storage engine "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'myarchive'")]),t._v(" doesn"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'t have this option\nmysql> updąte myarchive set c1='")]),t._v("ddd"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("' where id=1;\nERROR 1031 (HYO00): Table storage engine for '")]),t._v(" myarchive"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("' doesn'")]),t._v("t have this option\nmysql"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" create index idx_cl on myarchive"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \nERROR "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1069")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("42000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": Too many keys specified"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" max "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" keys allowed\n")])])]),n("p",[t._v("适用场景")]),t._v(" "),n("ul",[n("li",[t._v("日志和数据采集类应用")]),t._v(" "),n("li",[t._v("数据归档存储")])])]),t._v(" "),n("li",[n("p",[t._v("Memory 引擎的特点")]),t._v(" "),n("ol",[n("li",[t._v("非事务型存储引擎")]),t._v(" "),n("li",[t._v("数据保存在内存中")]),t._v(" "),n("li",[t._v("所有字段长度固定")]),t._v(" "),n("li",[t._v("支持 Btree 和 Hash 索引")])]),t._v(" "),n("p",[t._v("适用场景")]),t._v(" "),n("ul",[n("li",[t._v("用于缓存字典映射表")]),t._v(" "),n("li",[t._v("缓存周期性分析数据")])])]),t._v(" "),n("li",[n("p",[t._v("Innodb 引擎的特点")]),t._v(" "),n("ol",[n("li",[t._v("事务型存储引擎支持ACID")]),t._v(" "),n("li",[t._v("数据按主键聚集存储")]),t._v(" "),n("li",[t._v("支持行级锁及MVCC")]),t._v(" "),n("li",[t._v("支持Btree和自适应Hash索引")]),t._v(" "),n("li",[t._v("支持全文和空间索引")])]),t._v(" "),n("p",[t._v("适用场景：大多数 OLTP 场景")])]),t._v(" "),n("li",[n("p",[t._v("NDB 引擎的特点")]),t._v(" "),n("ol",[n("li",[t._v("事务型存储引擎")]),t._v(" "),n("li",[t._v("数据存储在内存中")]),t._v(" "),n("li",[t._v("支持行级锁")]),t._v(" "),n("li",[t._v("支持高可用集群")]),t._v(" "),n("li",[t._v("支持Ttree索引")])]),t._v(" "),n("p",[t._v("适用场景：需要数据完全同步的高可用场景")])])])]),t._v(" "),n("li",[n("p",[t._v("在什么情况下INNODB无法在线修改表\n知识点")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("Innodb不支持在线修改表结构的场景")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("操作")]),t._v(" "),n("th",[t._v("语法")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("加全文索引")]),t._v(" "),n("td",[t._v("CREATE FULLTEXT INDEX name ON table(column);")])]),t._v(" "),n("tr",[n("td",[t._v("加空间索引")]),t._v(" "),n("td",[t._v("ALTER TABLE geom ADD SPATIAL INDEX(g)")])]),t._v(" "),n("tr",[n("td",[t._v("删除主键")]),t._v(" "),n("td",[t._v("ALTER TABLE tbl name DROP PRIMARY KEY")])]),t._v(" "),n("tr",[n("td",[t._v("增加自增列")]),t._v(" "),n("td",[t._v("alter table t add column id int auto increment not null primary key")])]),t._v(" "),n("tr",[n("td",[t._v("修改列类型")]),t._v(" "),n("td",[t._v("ALTER TABLE tbl name CHANGE c1 c1 NEW TYPE")])]),t._v(" "),n("tr",[n("td",[t._v("改表字符集")]),t._v(" "),n("td",[t._v("ALTER TABLE tbl name CHARACTER SET = charset name")])])])]),t._v(" "),n("ul",[n("li",[n("p",[t._v("在线 DDL 存在的问题")]),t._v(" "),n("p",[t._v("有部分语句不支持在线DDL\n长时间的DDL操作会引起严重的主从延迟\n无法对DDL操作进行资源限制")])]),t._v(" "),n("li",[n("p",[t._v("如何更安全的执行DDL？")]),t._v(" "),n("p",[t._v("pt-online-schema-change[OPTIONS]DSN")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("mysql"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" alter table stock "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("column")]),t._v(" modified_time timestamp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("c\n\n$ pt-online-schema-change --alter "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"add column modified_time timestamp"')]),t._v(" --execute "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("D")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("stock,t"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("stock,u"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("dba,p"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v("\n")])])])])])]),t._v(" "),n("li",[n("p",[t._v("Innodb 是如何实现事务？")]),t._v(" "),n("p",[t._v("知识点")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("什么是事务？")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("特征")]),t._v(" "),n("th",[t._v("说明")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("原子性（A）")]),t._v(" "),n("td",[t._v("一个事务中的所有操作，要么全部完成，要么全部不完成，不会结束在中间某个环节。")])]),t._v(" "),n("tr",[n("td",[t._v("一致性（C）")]),t._v(" "),n("td",[t._v("在事务开始之前和事务结束以后，数据库的完整性没有被破坏。")])]),t._v(" "),n("tr",[n("td",[t._v("隔离性（I）")]),t._v(" "),n("td",[t._v("事务的隔离性要求每个读写事务的对象与其它事务的操作对象能相互分离，即该事务提交前对其它事务都不可见。")])]),t._v(" "),n("tr",[n("td",[t._v("持久性（D）")]),t._v(" "),n("td",[t._v("事务一旦提交了，其结果就是永久性的，就算发生了宕机等事故数据库也能将数据恢复。")])])])]),t._v(" "),n("p",[t._v("事务实现方式")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("特征")]),t._v(" "),n("th",[t._v("Innodb 实现方式")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("原子性（A）")]),t._v(" "),n("td",[t._v("回滚日志（Undo log）：用于记录数据修改前的状态")])]),t._v(" "),n("tr",[n("td",[t._v("一致性（C）")]),t._v(" "),n("td",[t._v("重作日志（Redo Log）：用于记录数据修改后的状态")])]),t._v(" "),n("tr",[n("td",[t._v("隔离性（I）")]),t._v(" "),n("td",[t._v("锁：用于资源隔离，分为共享锁和排它锁")])]),t._v(" "),n("tr",[n("td",[t._v("持久性（D）")]),t._v(" "),n("td",[t._v("重作日志（Redo log）+回滚日志（Undo Log）")])])])]),t._v(" "),n("p",[n("img",{attrs:{src:a(759),alt:"image-20201212151159149"}}),n("img",{attrs:{src:a(760),alt:"image-20201212151227030"}})])]),t._v(" "),n("li",[n("p",[t._v("Redo log 和 undo log 在事务实现中的作用")])]),t._v(" "),n("li",[n("p",[t._v("Innodb 读是否会阻塞写？")]),t._v(" "),n("p",[t._v("读写应该相互阻塞吗？")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("查询需要对资源加共享锁（S）")])]),t._v(" "),n("li",[n("p",[t._v("数据修改需要对资源加排它锁（x）")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th"),t._v(" "),n("th",[t._v("排它锁")]),t._v(" "),n("th",[t._v("共享锁")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("排它锁")]),t._v(" "),n("td",[t._v("不兼容")]),t._v(" "),n("td",[t._v("不兼容")])]),t._v(" "),n("tr",[n("td",[t._v("共享锁")]),t._v(" "),n("td",[t._v("不兼容")]),t._v(" "),n("td",[t._v("兼容")])])])]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# session-1")]),t._v("\nmysql"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" begin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmysql"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" * from stock.stock where "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v("   product_id  category_id  warehouse_id  count  modified_time\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2030")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v("            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("             "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2018")]),t._v("-08-31 09:51:22\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# session-2")]),t._v("\nmysql"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" begin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmysql"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" update stock.stock "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("count")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" where "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# session-1")]),t._v("\nmysql"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" * from stock.stock where "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查询没有被阻塞")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v("   product_id  category_id  warehouse_id  count  modified_time\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2030")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v("            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("             "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2018")]),t._v("-08-31 09:51:22\n")])])]),n("p",[t._v("知识点：InnoDB MVCC 的实现方式")]),t._v(" "),n("p",[n("img",{attrs:{src:a(761),alt:"image-20201212152524212"}})])])])])])]),t._v(" "),n("li",[n("p",[t._v("如何更安全的在线修改表结构")])])])]),t._v(" "),n("li",[n("p",[t._v("各种常见存储引擎的使用场景")])])])])])])}),[],!1,null,null,null);s.default=e.exports}}]);