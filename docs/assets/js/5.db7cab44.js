(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{730:function(t,s,a){t.exports=a.p+"assets/img/Docker-VS-VM.c5941af8.png"},731:function(t,s,a){t.exports=a.p+"assets/img/Docker-Arch.313c1727.png"},732:function(t,s,a){t.exports=a.p+"assets/img/Docker-Arch-2.e1cef741.png"},733:function(t,s,a){t.exports=a.p+"assets/img/Docker-Layer.9258dc29.png"},734:function(t,s,a){t.exports=a.p+"assets/img/docker-compose-app.d606041a.png"},783:function(t,s,a){"use strict";a.r(s);var n=a(49),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"docker-笔记"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-笔记"}},[t._v("#")]),t._v(" Docker 笔记")]),t._v(" "),n("h4",{attrs:{id:"总览"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总览"}},[t._v("#")]),t._v(" 总览")]),t._v(" "),n("ul",[n("li",[t._v("Docker 简介")]),t._v(" "),n("li",[t._v("镜像、容器与仓库")]),t._v(" "),n("li",[t._v("持久化容器数据（卷挂载）")]),t._v(" "),n("li",[t._v("编排多容器应用")]),t._v(" "),n("li",[t._v("网络（待补）")])]),t._v(" "),n("h4",{attrs:{id:"历史"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#历史"}},[t._v("#")]),t._v(" 历史")]),t._v(" "),n("ul",[n("li",[t._v("2010 dotCloud PAAS")]),t._v(" "),n("li",[t._v("2013 Docker 开源")]),t._v(" "),n("li",[t._v("2014.6 Docker 1.0")]),t._v(" "),n("li",[t._v("2014.7 C 轮 $4000 万")]),t._v(" "),n("li",[t._v("2015.4 D 轮 $9500 万")]),t._v(" "),n("li",[t._v("至今 Docker 1.13")])]),t._v(" "),n("h4",{attrs:{id:"简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("类比")]),t._v(" "),n("ul",[n("li",[t._v("粗糙地理解为轻量级的虚拟机")]),t._v(" "),n("li",[t._v("开挂的 chroot （chroot 对应用程序做了文件系统的分离，和 Docker 有相似支持）")]),t._v(" "),n("li",[t._v("确实不是虚拟机\n"),n("img",{attrs:{src:a(730),alt:"确实不是虚拟机"}})])])]),t._v(" "),n("li",[n("p",[t._v("思想")]),t._v(" "),n("ul",[n("li",[t._v("集装箱（弹性伸缩扩展）：双 11 来了，服务器撑不住啦！")]),t._v(" "),n("li",[t._v("标准化：我本地运行没问题啊！\n"),n("ul",[n("li",[t._v("运输方式")]),t._v(" "),n("li",[t._v("存储方式")]),t._v(" "),n("li",[t._v("API 接口")])])]),t._v(" "),n("li",[t._v("隔离：系统好卡，哪个哥们又写死循环了")])])]),t._v(" "),n("li",[n("p",[t._v("核心词汇")]),t._v(" "),n("ul",[n("li",[t._v("Build：镜像（文件系统：应用程序文件+环境文件）")]),t._v(" "),n("li",[t._v("Ship：仓库 hub.docker.com, c.163.com")]),t._v(" "),n("li",[t._v("Run：容器（本质是一个进程）")])])]),t._v(" "),n("li",[n("p",[t._v("适用：开发、测试、运维")])])]),t._v(" "),n("h4",{attrs:{id:"安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),n("ul",[n("li",[t._v("docker.com")]),t._v(" "),n("li",[t._v("配置 Registry mirrors 加速镜像")])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Mac 安装")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),t._v(" docker*.dmg\ndocker info\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Linux 下载安装")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" -qO- https://get.docker.com "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("usermod")]),t._v(" -aG docker imooc "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 允许非 root 用户（imooc）运行 docker，默认 docker 只允许 root 用户执行")]),t._v("\n")])])]),n("h4",{attrs:{id:"docker-常用命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-常用命令"}},[t._v("#")]),t._v(" Docker 常用命令")]),t._v(" "),n("p",[n("img",{attrs:{src:a(731),alt:"Docker架构"}}),t._v(" "),n("img",{attrs:{src:a(732),alt:"Docker架构2"}})]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 运行")]),t._v("\ndocker run --help\n\ndocker run ubuntu "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" hello docker\ndocker run -p "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v(":80 -d daocloud.io/nginx\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -P 容器所有端口映射到主机随机的端口")]),t._v("\ndocker run -P -d daocloud.io/nginx\n\ndocker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it 17add7bbc58c "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 停止运行的容器")]),t._v("\ndocker stop 17add7bbc58c\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取 image")]),t._v("\ndocker pull\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建 image")]),t._v("\ndocker build\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 运行 container")]),t._v("\ndocker run nginx\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看镜像 列出本地已有的 image")]),t._v("\ndocker images\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 列出 container ，查找容器的 id ，查看正在运行的程序")]),t._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" -a\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker cp: 在 host 和 container 之间拷贝文件")]),t._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" index.html 17add7bbc58c://usr/share/nginx/html\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 保存改动为新的 image")]),t._v("\ndocker commit -m "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fun'")]),t._v(" 17add7bbc58c nginx-fun\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除 image")]),t._v("\ndocker rmi 81a03c984999\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除 container")]),t._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" 17add7bbc58c 32ka49aibyy\n")])])]),n("h4",{attrs:{id:"dockerfile-介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-介绍"}},[t._v("#")]),t._v(" Dockerfile 介绍")]),t._v(" "),n("h5",{attrs:{id:"第一个-dockerfile"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第一个-dockerfile"}},[t._v("#")]),t._v(" 第一个 Dockerfile")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('# Dockerfile\n\n# 创建的新镜像，有一个基础镜像\nFROM alpine:latest\n\n# 共享的时候告诉其他人这是我写的\nMAINTAINER xbf\n\n# 运行容器产生的效果\n# 或 CMD ["echo", "hello docker"]\nCMD echo \'hello docker\'\n')])])]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用 Dockerfile 创建 image")]),t._v("\n\ndocker build -t hello_docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\ndocker images hello_docker\ndocker run hello_docker\n")])])]),n("h5",{attrs:{id:"第二个-dockerfile"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第二个-dockerfile"}},[t._v("#")]),t._v(" 第二个 Dockerfile")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('FROM ubuntu\nMAINTAINER xbf\nRUN sed -i \'s/archive.ubuntu.com/mirrors.ustu.edu.cn/g\' /etc/apt/sources.list # 使用加速镜像\nRUN apt-get update\nRUN apt-get install -y nginx\nCOPY index.html /var/www/html\nENTRYPOINT ["/usr/sbin/nginx", "-g", "daemon off;"]\nEXPOSE 80\n')])])]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("docker build -t xbf/hello-nginx "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\ndocker run -d -p "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(":80 xbf/hello-nginx\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" http://localhost\n")])])]),n("h5",{attrs:{id:"第三个-dockerfile"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第三个-dockerfile"}},[t._v("#")]),t._v(" 第三个 Dockerfile")]),t._v(" "),n("ul",[n("li",[t._v("jpress.io")])]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("FROM hub.c.163.com/library/tomcat\nMAINTAINER myname myemail@163.com\nCOPY jpress.war /usr/local/tomcat/webapps\n")])])]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("docker build -t jpress:latest "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\ndocker images\ndocker run -d -p "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),t._v(":8080 jpress\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v("\n\ndocker run -d p "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v(":3306 -e "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MYSQL_ROOT_PASSWORD")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("000000 -e "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MYSQL_DATABASE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("jpress hub.c.163.com/library/mysql:latest\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("netstat")]),t._v(" -an"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v("\n")])])]),n("ul",[n("li",[t._v("访问 http://localhost:8888/jpress/")])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启 jpress 容器")]),t._v("\ndocker restart 8abk38ed\n")])])]),n("h5",{attrs:{id:"dockerfile-语法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-语法"}},[t._v("#")]),t._v(" Dockerfile 语法")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("指令")]),t._v(" "),n("th",[t._v("含义")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("FROM")]),t._v(" "),n("td",[t._v("base image")])]),t._v(" "),n("tr",[n("td",[t._v("RUN")]),t._v(" "),n("td",[t._v("执行命令")])]),t._v(" "),n("tr",[n("td",[t._v("ADD")]),t._v(" "),n("td",[t._v("添加文件（可以添加远程文件）")])]),t._v(" "),n("tr",[n("td",[t._v("COPY")]),t._v(" "),n("td",[t._v("拷贝文件")])]),t._v(" "),n("tr",[n("td",[t._v("CMD")]),t._v(" "),n("td",[t._v("执行命令")])]),t._v(" "),n("tr",[n("td",[t._v("EXPOSE")]),t._v(" "),n("td",[t._v("暴露端口")])]),t._v(" "),n("tr",[n("td",[t._v("WORKDIR")]),t._v(" "),n("td",[t._v("指定路径")])]),t._v(" "),n("tr",[n("td",[t._v("MAINTAINER")]),t._v(" "),n("td",[t._v("维护者")])]),t._v(" "),n("tr",[n("td",[t._v("ENV")]),t._v(" "),n("td",[t._v("设定环境变量")])]),t._v(" "),n("tr",[n("td",[t._v("ENTRYPOINT")]),t._v(" "),n("td",[t._v("容器入口")])]),t._v(" "),n("tr",[n("td",[t._v("USER")]),t._v(" "),n("td",[t._v("指定用户")])]),t._v(" "),n("tr",[n("td",[t._v("VOLUME")]),t._v(" "),n("td",[t._v("mount point")])])])]),t._v(" "),n("h5",{attrs:{id:"镜像分层"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#镜像分层"}},[t._v("#")]),t._v(" 镜像分层")]),t._v(" "),n("ul",[n("li",[t._v("Dockerfile 中的每一行都产生一个新层。")]),t._v(" "),n("li",[t._v("每一层都有一个特定的独立的 id")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(733),alt:"镜像分层"}})]),t._v(" "),n("h4",{attrs:{id:"volume"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#volume"}},[t._v("#")]),t._v(" Volume")]),t._v(" "),n("ul",[n("li",[t._v("提供独立于容器之外的持久化存储。")])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("docker run -d --name nginx -v /usr/share/nginx/html nginx\ndocker inspect nginx "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 检查容器信息")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Mac 通过 screen /..../... 进入容器")]),t._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it nginx /bin/bash\n\ndocker run -p "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(":80 -d -v "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$PWD")]),t._v("/html:/usr/share/nginx/html nginx\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 容器卷（基础镜像为 ubuntu）")]),t._v("\ndocker create -v "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$PWD")]),t._v("/data:/var/mydata --name data_container ubuntu\ndocker run -it --volumes-from data_container my-app /bin/bash\n")])])]),n("h4",{attrs:{id:"registry-镜像仓库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#registry-镜像仓库"}},[t._v("#")]),t._v(" Registry 镜像仓库")]),t._v(" "),n("ul",[n("li",[t._v("官方 dockerhub 仓库。")]),t._v(" "),n("li",[t._v("国内：daocloud 、时速云、aliyun、c.163.com")])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 搜索镜像")]),t._v("\ndocker search whalesay\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 拉取镜像")]),t._v("\ndocker pull whalesay\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 推送镜像")]),t._v("\ndocker push myname/whalesay\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 拉取镜像")]),t._v("\ndocker pull docker/whalesay \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 运行 docker/whalesay")]),t._v("\ndocker run docker/whalesay cowsay Docker很Cool\n\ndocker tag docker/whalesay mengcoder/whalesay\n\ndocker images\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 登录远程仓库")]),t._v("\ndocker login\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 推送镜像到远程仓库")]),t._v("\ndocker push mengcoder/whalesay\n")])])]),n("h4",{attrs:{id:"docker-compose"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose"}},[t._v("#")]),t._v(" docker-compose")]),t._v(" "),n("h5",{attrs:{id:"安装-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装-2"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),n("ul",[n("li",[t._v("Mac/Windows 上的 docker: 自带")]),t._v(" "),n("li",[t._v("Linux:")])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -L https://github.com/docker/compose/releases/download/1.9.0/docker-compose-"),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("uname")]),t._v(" -s"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("-"),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("uname")]),t._v(" -m"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /usr/local/bin/docker-compose\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" +x ./usr/local/bin/docker-compose\ndocker-compose --version\n")])])]),n("h5",{attrs:{id:"多容器应用介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#多容器应用介绍"}},[t._v("#")]),t._v(" 多容器应用介绍")]),t._v(" "),n("p",[n("img",{attrs:{src:a(734),alt:"多容器app"}})]),t._v(" "),n("ul",[n("li",[t._v("配置文件：docker-compose.yaml")]),t._v(" "),n("li",[t._v("常用指令：")])]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("指令")]),t._v(" "),n("th",[t._v("含义")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("build")]),t._v(" "),n("td",[t._v("本地创建镜像")])]),t._v(" "),n("tr",[n("td",[t._v("command")]),t._v(" "),n("td",[t._v("覆盖缺省命令")])]),t._v(" "),n("tr",[n("td",[t._v("depends_on")]),t._v(" "),n("td",[t._v("连接容器")])]),t._v(" "),n("tr",[n("td",[t._v("ports")]),t._v(" "),n("td",[t._v("暴露端口")])]),t._v(" "),n("tr",[n("td",[t._v("volumes")]),t._v(" "),n("td",[t._v("卷")])]),t._v(" "),n("tr",[n("td",[t._v("image")]),t._v(" "),n("td",[t._v("pull镜像")])])])]),t._v(" "),n("ul",[n("li",[t._v("docker-compose 命令")])]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("命令")]),t._v(" "),n("th",[t._v("用途")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("up")]),t._v(" "),n("td",[t._v("启动服务")])]),t._v(" "),n("tr",[n("td",[t._v("stop")]),t._v(" "),n("td",[t._v("停止服务")])]),t._v(" "),n("tr",[n("td",[t._v("rm")]),t._v(" "),n("td",[t._v("删除服务中的各个容器")])]),t._v(" "),n("tr",[n("td",[t._v("logs")]),t._v(" "),n("td",[t._v("观察各个容器的日志")])]),t._v(" "),n("tr",[n("td",[t._v("ps")]),t._v(" "),n("td",[t._v("列出服务相关的容器")])])])]),t._v(" "),n("h5",{attrs:{id:"多容器应用编排"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#多容器应用编排"}},[t._v("#")]),t._v(" 多容器应用编排")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" ghost nginx data\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ghost\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" Dockerfile\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" config.js\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('# ghost/Dockerfile\n\nFROM ghost\nCOPY ./config.js /var/lib/ghost/config.js\nEXPOSE 2368\nCMD ["npm", "start", "--production"]\n')])])]),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ghost/config.js")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" path "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconfig "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  production"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    url"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://mytestblog.com'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    mail"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    database"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      client"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mysql'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      connection"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        host"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'db'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        user"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ghost'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        database"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ghost'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        port"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3306'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        charset"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf8'")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      debug"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    paths"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      contentPath"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GHOST_CONTENT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("','")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    server"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      host"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0.0.0.0'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      port"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2368'")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/nginx\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" Dockerfile\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" nginx.conf\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("# nginx/Dockfile\n\nFROM nginx\nCOPY nginx.conf /etc/nginx/nginx.conf\nEXPOSE 80\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("# nginx/nginx.conf\n\nworker processes 4;\nevents {worker connections 1024;}\nhttp {\n  server {\n    listen 80;\n    location / {\n      proxy_pass http://ghost-app:2368;\n    }\n  }\n}\n")])])]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" docker-compose.yml\n")])])]),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker-compose.yml")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ghost")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ghost-app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ghost\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networkds")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ghost\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" db\n     "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2368:2368"')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nginx")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ghost\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ghost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("app\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"80:80"')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("images")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mysql:5.7.15"')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ghost\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_ROOT_PASSWORD")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysqlroot\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_USER")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ghost\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_PASSWORD")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ghost\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" $PWD/data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/mysql\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3306:3306"')]),t._v("\n")])])]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("tree\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("  docker-composer.yml\n  ghost/\n    config.js\n    Dockerfile\n  nginx/\n    Dockerfile\n    nginx.conf\n  data/\n")])])]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("docker-compose stop\ndocker-compose "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v("\n\n\ndocker-compose build\ndocker-composer up -d\n")])])]),n("h4",{attrs:{id:"参考"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),n("p",[t._v("https://www.imooc.com/learn/867"),n("br"),t._v("\nhttps://www.imooc.com/learn/824")]),t._v(" "),n("h4",{attrs:{id:"编辑记录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编辑记录"}},[t._v("#")]),t._v(" 编辑记录")]),t._v(" "),n("p",[t._v("创建 2019-02-23 23:53:00 周六"),n("br"),t._v("\n编辑 2019-02-25 23:01:00 周一"),n("br")])])}),[],!1,null,null,null);s.default=e.exports}}]);