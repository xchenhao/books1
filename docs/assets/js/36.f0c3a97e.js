(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{865:function(s,t,a){"use strict";a.r(t);var n=a(25),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"日志类问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志类问题"}},[s._v("#")]),s._v(" 日志类问题")]),s._v(" "),a("ol",[a("li",[s._v("常用的MySQL日志有那些？我们在什么情况下使用这些日志？")]),s._v(" "),a("li",[s._v("如何通过日志来审计用户活动？")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("常用的 MySQL 日志及使用场景")]),s._v(" "),a("p",[s._v("知识点")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("MySQL 常用的日志类型")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("日志名称")]),s._v(" "),a("th",[s._v("作用")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("错误日志（error-log）")]),s._v(" "),a("td",[s._v("记录mysql在启动、运行或停止时出现的问题")])]),s._v(" "),a("tr",[a("td",[s._v("常规日志（general-log）")]),s._v(" "),a("td",[s._v("记录所有发向MySQL的请求。")])]),s._v(" "),a("tr",[a("td",[s._v("慢查日志（slow-query-log）")]),s._v(" "),a("td",[s._v("记录符合条件的查询")])]),s._v(" "),a("tr",[a("td",[s._v("二进制日志（binary_log）")]),s._v(" "),a("td",[s._v("记录全部有效的数据修改日志")])]),s._v(" "),a("tr",[a("td",[s._v("中继日志（relay_log）")]),s._v(" "),a("td",[s._v("用于主从复制，临时存储从主库同步的二进制日志")])])])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("错误日志（error-log）")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("分析排除MySQL运行错误")])]),s._v(" "),a("li",[a("p",[s._v("记录未经授权的访问")])]),s._v(" "),a("li",[a("p",[s._v("log_error = $mysql/sql_log/mysql-error. log")])]),s._v(" "),a("li",[a("p",[s._v("log_error_verbosity = [1,2,3]")])])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("verbosity")]),s._v(" "),a("th",[s._v("作用")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("1")]),s._v(" "),a("td",[s._v("Error messages")])]),s._v(" "),a("tr",[a("td",[s._v("2")]),s._v(" "),a("td",[s._v("Error and warning messages")])]),s._v(" "),a("tr",[a("td",[s._v("3")]),s._v(" "),a("td",[s._v("Error, warning, and note messages")])])])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("log_error_services=[日志服务组件；日志服务组件]")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("组件名称")]),s._v(" "),a("th",[s._v("作用")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("log_filter_internal")]),s._v(" "),a("td",[s._v("默认的日志过滤组件，依赖log_error_verbosity")])]),s._v(" "),a("tr",[a("td",[s._v("log_sink_internal")]),s._v(" "),a("td",[s._v("默认的日志输出组件，依赖log_error")])]),s._v(" "),a("tr",[a("td",[s._v("log_sink_json")]),s._v(" "),a("td",[s._v("将错误日志输出到json文件")])]),s._v(" "),a("tr",[a("td",[s._v("log_sink_syseventlog")]),s._v(" "),a("td",[s._v("将错误日志输出到系统日志文件")])])])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" @@log_error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n/home/mysql/sql_log/mysql-error.log\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" @@log_error_verbosity"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" @@log_error_services"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nlog_filter_internal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" log_sink_internal\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" @@log_timestamps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nUTC\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" persist "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("log_timestamps")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SYSTEM'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])])])])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("常规日志（general_log）")]),s._v(" "),a("p",[s._v("分析客户端发送到 MySQL 的实际请求")]),s._v(" "),a("ul",[a("li",[s._v("general_log = [ON|OFF]")]),s._v(" "),a("li",[s._v("general_log_file = $mysql/sql_log/general.log")]),s._v(" "),a("li",[s._v("log_output = [FILE | TABLE | NONE]")])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" use mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show create table general_log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("G\nTable: general_log\nCreate Table: CREATE TABLE general_log "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\tevent_time timestamp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" NOT NULL DEFAULT CURRENT-TIMESTAMP "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" ON UPDATE CURRENT_TIMESTAMP "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",\n\tuser_host mediumtext NOT NULL, thread_id bigint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" unsigned NOT NULL, \t\tserver_id int"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" unsigned NOT NULL, command_type varchar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" NOT NULL, \targument mediumblob NOT NULL\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" ENGINE-CSV DEFAULT CHARSET-utf8 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("COMMENT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'General log'")]),s._v("\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" @@general_log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" @@general_log_file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n/home/mysql/data/MysQL-06.1og\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" persist "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("general_log_file")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/home/mysql/sql_log/general.1og'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" @@general_log_file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n/home/mysql/sql_log/general.1og\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" @@log_output"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nFILE\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" global "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("general_log")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -f /home/mysql/sql_log/general_log\n/home/mysql/bin/mysqld, version: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.0")]),s._v(".11 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("source distribution"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(". started with: Tcp port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(" Unix socket: /home/mysql/data/mysql.sock\nTime Id "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" Argument\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("/8/27 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":36:26  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" Query show databases\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("/8/27 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":36:55  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" Quit\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("/8/27 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":37:07  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" connect root@localhost on using socket\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("/8/27 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":37:07  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" Query "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" @@version_comment limit "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" global "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("general_log")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" global "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("log_output")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'table'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" global "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("general_log")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  create user dba_test@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'127.0.0.1'")]),s._v(" identified by "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" * from general_log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" rows "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v("\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" general_log.csv\n")])])])])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("慢查询日志（slow_query_log）")]),s._v(" "),a("ul",[a("li",[s._v("将执行成功并符合条件的查询记录到日志中")]),s._v(" "),a("li",[s._v("找到需要优化的SQL")]),s._v(" "),a("li",[s._v("slow_query_log =[ON I OFF]")]),s._v(" "),a("li",[s._v("slow_query_log_file = $mysql/sql_log/slowlog.log")]),s._v(" "),a("li",[s._v("long.query_time = xx秒")]),s._v(" "),a("li",[s._v("log_queries_not_using_indexes= [ON | OFF]")]),s._v(" "),a("li",[s._v("log_slow_admin_statements= [ON | OFF]")]),s._v(" "),a("li",[s._v("log_slow_slave_statements = [ON | OFF]")])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show variables like "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'long_query_time'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" persist "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("long_query_time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.001")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show variables like "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'slow_query_log%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nslow_query_log OFF\nslow_query_log_file /home/mysql/sql_log/slowlog_1305.log\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" global "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("slow_query_log")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" /home/mysql/sql_log/slowlog_1305.log\n")])])])]),s._v(" "),a("li",[a("p",[s._v("二进制日志（binary_log）")]),s._v(" "),a("ul",[a("li",[s._v("记录所有对数据库中数据的修改")]),s._v(" "),a("li",[s._v("基于时间点的备份和恢复")]),s._v(" "),a("li",[s._v("主从复制")]),s._v(" "),a("li",[s._v("log-bin [=base_name]")]),s._v(" "),a("li",[s._v("binlog_format = [ROW | STATEMENT | MIXED ]")]),s._v(" "),a("li",[s._v("binlog_row_image = [FULL | MINIMAL | NOBLOB ]")]),s._v(" "),a("li",[s._v("binlog_rows_query_log_events=[ON |OFF]")]),s._v(" "),a("li",[s._v("log_slave_updates = [ON | OFF]")]),s._v(" "),a("li",[s._v("sync_binlog = [1 | 0]")]),s._v(" "),a("li",[s._v("expire_logs_days = days")]),s._v(" "),a("li",[s._v("PURGE BINARY LOGS TO ' mysql-bin.010'")]),s._v(" "),a("li",[s._v("PURGE BINARY LOGS BEFORE '2008-04-02 22:46:26';")])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("root@MysQL-06 ~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# grep log_bin /etc/my.cnf")]),s._v("\n1og_bin "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/home/mysql/sql_log/mysq1-bin\nroot@MysQL-06 ~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /home/mysql/sql_log")]),s._v("\nroot@MysQL-06 sql_log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1s-lh ")]),s._v("\ntotal 32K\n-rw-r-----1 mysql mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("665")]),s._v("  Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" 07:38 general.1og\n-rw-r-----1 mysq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("178")]),s._v("  Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":46 mysql-bin.000001\n-rw-r-----1 mysql mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".2K Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":53 mysql-bin.000002\n-rw-r-----1 mysql mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("74")]),s._v("   Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":47 mysql-bin.index\n-rw-r-----1 mysql mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".3K Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":53 mysql-error.log\n-rw-r---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".5K Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":49 s1owlog_1305.log\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@MysQL-06 sql_log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show variables like "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'log_bin%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nlog_bin ON\nlog_bin_basename /home/mysql/sql_1og/mysql-bin\nloq_bin_index /home/mysq/sql_log/mysql-bin.index\nlog_bin_trust_function_creators OFF\nlog_bin_use_v1_row_events OFF\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show variables like "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'binlog_row_image'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nbinlog_row_image FULL\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show variables like "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'binlog_format'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nbinlog_format ROW\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" flush logs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" update stock "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("count")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" where "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("product_id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2030")]),s._v(" and "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("warehouse_id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n$ mysqlbinlog --no-defaults -vv --base64-output"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DECODE-ROWS mysql-bin.000003\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#180829 7:56:46 server id 1306")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("' stock mapped to number 95\n# at 411\n#180829 7:56:46 server id 1306\nid 95 flags: STMT END_F\n### UPDATE "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("stock.stock"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n### WHERE\n### @1-1 /* INT meta-0 nullable=0 is-nul1-0 *\n### @2-2030 /* INT meta-0 nullable-0 is_nul1-0 */\n### @3-9 /* INT meta-0 nullable=0 is-nu11-0 */### @4-1 /* INT meta-0 nullable=0 is_nu71-0 */\n### @5-10 /* INT meta-0 nullable=0 is_nul1-0\n...\n\nmysql> flush logs;\nmysql> set global binlog_row_image=minimal;\nmysql> show variables like '")]),s._v("binlog_row_image"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("';\nbinlog_row_image FULL\nmysql> set session binlog_row_image=minimal;\nmysql> show variables like '")]),s._v("binlog_row_image"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("';\nbinlog_row_image MINIMAL\n\n$ mysqlbinlog --no-defaults -vv --base64-output=DECODE-ROWS mysql-bin.000003\nSET @@ session. character_set_client=8,@@ session. coTlation_connection-8, aasession. coTlation_\nserver=33/*!*/: SET @@ session. ic_time_names-0/* ! */\nSET @ asession. collation_database-DEFAULT/* !*/;\n/*!80005 SET @ asession. default_co1 1ation_for_utf8mb4-255*//* !*/; BEGIN/*!/;\n# at 355\n#180829 8:00:18 server id 1306 end_log_pos 411 CRC32 0x59a5048a Table_map: stock stock` mapped to number 95\nat 411\n|#180829 8:00:18 server id 1306 end_1og_pos 457 CRC32 0xb2346a68\nid 95 fTags: STMT END_F Update_rows: tablel\n|F# UPDATEstock. stock\n### WHERE\n###\n@1-1 /* INT meta-0 nuTTabTe-0 is_nul1=0 /\n### SET\n##\na5-30 /INT meta=0 nuTlabTe=0 is_nul1=0*/\nat 457\n#180829 8:00:18 server id 1306 end_log_pos 488 CRC32 Ox06a5db2o xid = 194\nCOMMIT/* !/; SET aasESSION. GTID_NEXT= '")]),s._v(" AUTOMATIC"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("' /* added by mysqlbinlog *//*!*/; DELIMITER End of log file\n/!50003 SET COMPLETION_TYPE-@ OLD_COMPLETION_TYPE*/;\n50530 SETOd ET QaSESSION. PSEUDO_SLAVE MODE-0/;\n\n\nmysql> flush logs;\nmysql> show variables like '")]),s._v("binlog_rows_query_log_events"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("';\nbinlog_rows_query_log_events OFF\nmysql> set binlog_rows_query_log_events=on;\nmysql> update stock set count=40 where product_id=2030 and warehouse_id=1;\n\n$ mysqlbinlog --no-defaults -vv --base64-output=DECODE-ROWS mysql-bin.000003\nSET@@session.collation_database-DEFAULT/*/；\n/*180005 SET@asession.default_collation_forutf8mb4-255*//※！*/；\n|BEGIN\n//；\n#at 355\n|#180829 8：05：08 server id 1306 end_log_pos 445 CRC32 0x84fodbdf update stock set count=40 where product_id-2030 and warehouse_id=1\nRows_query at 445\n#180829 8：05：08 server id 1306 end_1og_pos 501 CRC32 Oxa49ecc14\nstock mapped to number 95\n*at 501\n|#180829 8：05：08 server id 1306 end_log_pos 547 CRC32 0xfe46b671\nid 95 flags：STMT END_F\n|###UPDATE\"stockstock\n|###WHERE\n|###\na1=1/*INT meta=0 nullable=o is_nul1-0*/\n|##SET\n|###\n@5-40/INT meta-0 nullable-0 is_nul1-0*/\n|#at 547\n|#180829 8：05：08 server id 1306 end_log_pos 578 CRC32 0x44a85943\nxid = 198\n|COMMIT/*！*/；\n|SET@aSESSION.GTID-NEXT'")]),s._v("AUTOMATIC'/*added by mysqlbinlog*//※*/\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("DELIMITER\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#End of 1og file")]),s._v("\n/！50003 SET COMPLETION_TYPE-@OLD_COMPLETION_TYPE*/：\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("\n！50530 SET@@"),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("SESSION")]),s._v(".PSEUDO_SLAVE_MODE-0*/；Table_map：`stock Update_rows：table\n")])])])]),s._v(" "),a("li",[a("p",[s._v("中继日志（relay_log）")]),s._v(" "),a("ul",[a("li",[s._v("临时记录从主服务器同步的二进制日志")]),s._v(" "),a("li",[s._v("relay_log = filename")]),s._v(" "),a("li",[s._v("relay_log_purge = [ON | OFF]")])])])])]),s._v(" "),a("li",[a("p",[s._v("各种日志的配置和使用场景")])])])])])])}),[],!1,null,null,null);t.default=e.exports}}]);