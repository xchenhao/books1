<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>Mongo 起步 | 不可思议</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="xchenhao.gitee.io">
    <link rel="preload" href="/assets/css/0.styles.dcdd4981.css" as="style"><link rel="preload" href="/assets/js/app.38984056.js" as="script"><link rel="preload" href="/assets/js/3.3d2e4cc1.js" as="script"><link rel="preload" href="/assets/js/31.8c594f12.js" as="script"><link rel="prefetch" href="/assets/js/10.b026ad5d.js"><link rel="prefetch" href="/assets/js/11.b0403ef5.js"><link rel="prefetch" href="/assets/js/12.fca7a2f5.js"><link rel="prefetch" href="/assets/js/13.b0df6f4f.js"><link rel="prefetch" href="/assets/js/14.4003522f.js"><link rel="prefetch" href="/assets/js/15.58b6f351.js"><link rel="prefetch" href="/assets/js/16.447b7402.js"><link rel="prefetch" href="/assets/js/17.f858feb7.js"><link rel="prefetch" href="/assets/js/18.5d0c6b39.js"><link rel="prefetch" href="/assets/js/19.1f542932.js"><link rel="prefetch" href="/assets/js/20.b74c0525.js"><link rel="prefetch" href="/assets/js/21.32c260eb.js"><link rel="prefetch" href="/assets/js/22.c6f2004c.js"><link rel="prefetch" href="/assets/js/23.96c43c70.js"><link rel="prefetch" href="/assets/js/24.2b3b99e2.js"><link rel="prefetch" href="/assets/js/25.c249dd9c.js"><link rel="prefetch" href="/assets/js/26.242afa0f.js"><link rel="prefetch" href="/assets/js/27.324469e6.js"><link rel="prefetch" href="/assets/js/28.a8619cc6.js"><link rel="prefetch" href="/assets/js/29.a0ac54f5.js"><link rel="prefetch" href="/assets/js/30.373072e2.js"><link rel="prefetch" href="/assets/js/32.debc2926.js"><link rel="prefetch" href="/assets/js/33.795b9f0a.js"><link rel="prefetch" href="/assets/js/34.d6fab697.js"><link rel="prefetch" href="/assets/js/35.c17e1ad1.js"><link rel="prefetch" href="/assets/js/36.19da97f7.js"><link rel="prefetch" href="/assets/js/37.86d50c6f.js"><link rel="prefetch" href="/assets/js/38.851db332.js"><link rel="prefetch" href="/assets/js/39.03abafe9.js"><link rel="prefetch" href="/assets/js/4.9bf0d44e.js"><link rel="prefetch" href="/assets/js/40.9d14acde.js"><link rel="prefetch" href="/assets/js/41.fdfe888a.js"><link rel="prefetch" href="/assets/js/42.c412929f.js"><link rel="prefetch" href="/assets/js/43.a29eadf0.js"><link rel="prefetch" href="/assets/js/44.7a991361.js"><link rel="prefetch" href="/assets/js/45.e1544482.js"><link rel="prefetch" href="/assets/js/46.3ec424d9.js"><link rel="prefetch" href="/assets/js/47.527f842f.js"><link rel="prefetch" href="/assets/js/48.4736274c.js"><link rel="prefetch" href="/assets/js/49.21801344.js"><link rel="prefetch" href="/assets/js/5.6ac7e6ae.js"><link rel="prefetch" href="/assets/js/50.048b3e90.js"><link rel="prefetch" href="/assets/js/51.588815c6.js"><link rel="prefetch" href="/assets/js/52.33c56239.js"><link rel="prefetch" href="/assets/js/53.f4737b7a.js"><link rel="prefetch" href="/assets/js/54.272aafae.js"><link rel="prefetch" href="/assets/js/55.59a14652.js"><link rel="prefetch" href="/assets/js/6.302fce31.js"><link rel="prefetch" href="/assets/js/7.0def4eb7.js"><link rel="prefetch" href="/assets/js/8.d0119b48.js"><link rel="prefetch" href="/assets/js/9.f6d981ca.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.8b19d9a7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.dcdd4981.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="sidebar-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="/" class="router-link-active no-logo home-link"><!----> <span class="site-name">不可思议</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-submenu-selected"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          数据库
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          语言
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <!----></nav></div></div> <!----></header> <aside class="sidebar"><!----> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>数据库</span> <span class="arrow down"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Hive.html" title="Hive" class="sidebar-link">Hive</a></li><li><a href="/ODPS.html" title="ODPS" class="sidebar-link">ODPS</a></li><li><a href="/mongodb/MongoBasis.html" aria-current="page" title="MongoDB 基础" class="active sidebar-link">MongoDB 基础</a></li><li><a href="/mongodb/MongoBegin.html" title="MongoDB 起步" class="sidebar-link">MongoDB 起步</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MySQL</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Shell</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node.js</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其它</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><a href="/books-note.html" title="读书笔记" class="sidebar-link">读书笔记</a></li><li><a href="/update_log.html" title="更新记录" class="sidebar-link">更新记录</a></li></ul></aside> <main class="page"> <div class="theme-antdocs-content content__default"><h4 id="mongo-起步"><a href="#mongo-起步" class="header-anchor">#</a> Mongo 起步</h4> <h5 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h5> <div class="language-shell extra-class"><pre class="language-shell"><code>brew <span class="token function">install</span> mongodb

<span class="token comment"># 遇到 Error: An unexpected error occurred during the `brew link` step 解决方法</span>
<span class="token comment"># 参考 https://blog.csdn.net/qq_24909089/article/details/83378210</span>
<span class="token function">sudo</span> <span class="token function">mkdir</span> /usr/local/Frameworks
<span class="token function">sudo</span> <span class="token function">chown</span> -R <span class="token variable"><span class="token variable">$(</span><span class="token function">whoami</span><span class="token variable">)</span></span> /usr/local/Frameworks
</code></pre></div><h5 id="启动"><a href="#启动" class="header-anchor">#</a> 启动</h5> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 启动服务器</span>
<span class="token function">mkdir</span> -p ./mongodb/data/db
mongod --dbpath ./mongodb/data/db

<span class="token comment"># 启动客户端</span>
mongo
</code></pre></div><h4 id="小试牛刀"><a href="#小试牛刀" class="header-anchor">#</a> 小试牛刀</h4> <h5 id="查看数据库"><a href="#查看数据库" class="header-anchor">#</a> 查看数据库</h5> <blockquote><p>show dbs</p></blockquote> <p>admin   0.000GB
config  0.000GB
local   0.000GB</p> <h5 id="创建-进入数据库"><a href="#创建-进入数据库" class="header-anchor">#</a> 创建/进入数据库</h5> <blockquote><p>use test</p></blockquote> <div class="language- extra-class"><pre><code>switched to db test
</code></pre></div><h5 id="查看当前数据库"><a href="#查看当前数据库" class="header-anchor">#</a> 查看当前数据库</h5> <blockquote><p>db</p></blockquote> <div class="language- extra-class"><pre><code>test
</code></pre></div><h5 id="插入文档"><a href="#插入文档" class="header-anchor">#</a> 插入文档</h5> <blockquote><p>db.myCollection.insert({'fruit': 'apple'})</p></blockquote> <div class="language- extra-class"><pre><code>WriteResult({ &quot;nInserted&quot; : 1 })
</code></pre></div><h5 id="查看文档"><a href="#查看文档" class="header-anchor">#</a> 查看文档</h5> <blockquote><p>db.myCollection.find()</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd6931cb2978f4bd9becafc&quot;), &quot;fruit&quot; : &quot;apple&quot; }
</code></pre></div><h5 id="查看当前数据库的所有集合"><a href="#查看当前数据库的所有集合" class="header-anchor">#</a> 查看当前数据库的所有集合</h5> <blockquote><p>show tables 或 show collections</p></blockquote> <div class="language- extra-class"><pre><code>myCollection
</code></pre></div><h5 id="删除文档"><a href="#删除文档" class="header-anchor">#</a> 删除文档</h5> <blockquote><p>db.myCollection.remove()</p></blockquote> <div class="language- extra-class"><pre><code>WriteResult({ &quot;nRemoved&quot; : 1 })
</code></pre></div><h5 id="删除集合"><a href="#删除集合" class="header-anchor">#</a> 删除集合</h5> <blockquote><p>db.myCollection.drop()</p></blockquote> <div class="language- extra-class"><pre><code>true
</code></pre></div><h5 id="删除当前数据库"><a href="#删除当前数据库" class="header-anchor">#</a> 删除当前数据库</h5> <blockquote><p>db.dropDatabase()</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;dropped&quot; : &quot;test&quot;, &quot;ok&quot; : 1 } 
</code></pre></div><h4 id="更新-update-query-update-upsert-multi"><a href="#更新-update-query-update-upsert-multi" class="header-anchor">#</a> 更新 update(query, update, upsert, multi)</h4> <h5 id="inc-增加计数"><a href="#inc-增加计数" class="header-anchor">#</a> $inc 增加计数</h5> <blockquote><p>数据准备
db.myCollection.insert({&quot;fruit&quot;: &quot;banana&quot;, &quot;count&quot;: 1})</p></blockquote> <blockquote><p>增加 3
db.myCollection.update({&quot;fruit&quot;: &quot;banana&quot;}, {$inc: {&quot;count&quot;: 3}})
db.myCollection.find()</p></blockquote> <div class="language- extra-class"><pre><code># 由 1 变成 4
{ &quot;_id&quot; : ObjectId(&quot;5cd69a30b2978f4bd9becafd&quot;), &quot;fruit&quot; : &quot;banana&quot;, &quot;count&quot; : 4 }
</code></pre></div><h5 id="set-设置字段值-若不存在则创建-已存在则覆盖-unset-删除字段"><a href="#set-设置字段值-若不存在则创建-已存在则覆盖-unset-删除字段" class="header-anchor">#</a> $set 设置字段值（若不存在则创建，已存在则覆盖），$unset 删除字段</h5> <blockquote><p>增加字段 owner
db.myCollection.update({&quot;fruit&quot;: &quot;banana&quot;}, {&quot;$set&quot;: {&quot;owner&quot;: &quot;xchenhao&quot;}})
db.myCollection.find()</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd69a30b2978f4bd9becafd&quot;), &quot;fruit&quot; : &quot;banana&quot;, &quot;count&quot; : 4, &quot;owner&quot; : &quot;xchenhao&quot; }
</code></pre></div><blockquote><p>已存在情况下则覆盖原有
db.myCollection.update({&quot;fruit&quot;: &quot;banana&quot;}, {&quot;$set&quot;: {&quot;owner&quot;: &quot;somebody&quot;}})
db.myCollection.find()</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd69a30b2978f4bd9becafd&quot;), &quot;fruit&quot; : &quot;banana&quot;, &quot;count&quot; : 4, &quot;owner&quot; : &quot;somebody&quot; }
</code></pre></div><blockquote><p>删除字段
db.myCollection.update({&quot;fruit&quot;: &quot;banana&quot;}, {&quot;$unset&quot;: {&quot;owner&quot;: 1}})
db.myCollection.find()</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd69a30b2978f4bd9becafd&quot;), &quot;fruit&quot; : &quot;banana&quot;, &quot;count&quot; : 4 }
</code></pre></div><h5 id="push-对数组追加元素"><a href="#push-对数组追加元素" class="header-anchor">#</a> $push 对数组追加元素</h5> <blockquote><p>db.myCollection.update({&quot;fruit&quot;: &quot;banana&quot;}, {$push: {&quot;owner&quot;: &quot;xchenhao&quot;}})
db.myCollection.update({&quot;fruit&quot;: &quot;banana&quot;}, {$push: {&quot;owner&quot;: &quot;somebody&quot;}})
db.myCollection.update({&quot;fruit&quot;: &quot;banana&quot;}, {$push: {&quot;owner&quot;: &quot;somebody&quot;}})
db.myCollection.find()</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd69a30b2978f4bd9becafd&quot;), &quot;fruit&quot; : &quot;banana&quot;, &quot;count&quot; : 4, &quot;owner&quot; : [ &quot;xchenhao&quot;, &quot;somebody&quot;, &quot;somebody&quot; ] }
</code></pre></div><h5 id="pop-从数组元素中弹出元素-1-从尾部-1-从头部"><a href="#pop-从数组元素中弹出元素-1-从尾部-1-从头部" class="header-anchor">#</a> $pop 从数组元素中弹出元素（1 从尾部，-1 从头部）</h5> <blockquote><p>db.myCollection.update({&quot;fruit&quot;: &quot;banana&quot;}, {$pop: {&quot;owner&quot;: 1}})
db.myCollection.find()</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd69a30b2978f4bd9becafd&quot;), &quot;fruit&quot; : &quot;banana&quot;, &quot;count&quot; : 4, &quot;owner&quot; : [ &quot;xchenhao&quot;, &quot;somebody&quot; ] }
</code></pre></div><h5 id="addtoset-添加到集合中-若已存在则不会增加"><a href="#addtoset-添加到集合中-若已存在则不会增加" class="header-anchor">#</a> $addToSet 添加到集合中（若已存在则不会增加）</h5> <blockquote><p>$each 可以依次增加
db.myCollection.update({&quot;fruit&quot;: &quot;banana&quot;}, {$addToSet: {&quot;owner&quot;: {$each: [&quot;somebody&quot;, &quot;someone&quot;]}}})
db.myCollection.find()</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd69a30b2978f4bd9becafd&quot;), &quot;fruit&quot; : &quot;banana&quot;, &quot;count&quot; : 4, &quot;owner&quot; : [ &quot;xchenhao&quot;, &quot;somebody&quot;, &quot;someone&quot; ] }
</code></pre></div><blockquote><p>db.myCollection.update({&quot;fruit&quot;: &quot;banana&quot;}, {$pop: {&quot;owner&quot;: -1}})
db.myCollection.find()</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd69a30b2978f4bd9becafd&quot;), &quot;fruit&quot; : &quot;banana&quot;, &quot;count&quot; : 4, &quot;owner&quot; : [ &quot;somebody&quot;, &quot;someone&quot; ] }
</code></pre></div><h5 id="pull-删除数组中完全匹配的元素"><a href="#pull-删除数组中完全匹配的元素" class="header-anchor">#</a> $pull 删除数组中完全匹配的元素</h5> <blockquote><p>db.myCollection.update({&quot;fruit&quot;: &quot;banana&quot;}, {$push: {&quot;owner&quot;: &quot;somebody&quot;}})
db.myCollection.find()</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd69a30b2978f4bd9becafd&quot;), &quot;fruit&quot; : &quot;banana&quot;, &quot;count&quot; : 4, &quot;owner&quot; : [ &quot;somebody&quot;, &quot;someone&quot;, &quot;somebody&quot; ] }
</code></pre></div><blockquote><p>db.myCollection.update({&quot;fruit&quot;: &quot;banana&quot;}, {$pull: {&quot;owner&quot;: &quot;somebody&quot;}})
db.myCollection.find()</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd69a30b2978f4bd9becafd&quot;), &quot;fruit&quot; : &quot;banana&quot;, &quot;count&quot; : 4, &quot;owner&quot; : [ &quot;someone&quot; ] }
</code></pre></div><h5 id="set-的补充说明-对数组中的某个位置元素进行更新"><a href="#set-的补充说明-对数组中的某个位置元素进行更新" class="header-anchor">#</a> $set 的补充说明：对数组中的某个位置元素进行更新</h5> <blockquote><p>准备数据
db.myCollection.update({&quot;fruit&quot;: &quot;banana&quot;}, {$set: {&quot;owner&quot;: [&quot;xchenhao&quot;, &quot;somebody&quot;, &quot;someone&quot;]}})
db.myCollection.find()</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd69a30b2978f4bd9becafd&quot;), &quot;fruit&quot; : &quot;banana&quot;, &quot;count&quot; : 4, &quot;owner&quot; : [ &quot;xchenhao&quot;, &quot;somebody&quot;, &quot;someone&quot; ] }
</code></pre></div><blockquote><p>对数组第一个元素进行更新
db.myCollection.update({&quot;fruit&quot;: &quot;banana&quot;}, {$set: {&quot;owner.0&quot;: &quot;whoami&quot;}})
db.myCollection.find()</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd69a30b2978f4bd9becafd&quot;), &quot;fruit&quot; : &quot;banana&quot;, &quot;count&quot; : 4, &quot;owner&quot; : [ &quot;whoami&quot;, &quot;somebody&quot;, &quot;someone&quot; ] }
</code></pre></div><blockquote><p>不知道位置则用 $ 代替（查找到的位置）
db.myCollection.update({&quot;owner&quot;: &quot;whoami&quot;}, {$set: {&quot;owner.$&quot;: &quot;It is me&quot;}})
db.myCollection.find()</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd69a30b2978f4bd9becafd&quot;), &quot;fruit&quot; : &quot;banana&quot;, &quot;count&quot; : 4, &quot;owner&quot; : [ &quot;It is me&quot;, &quot;somebody&quot;, &quot;someone&quot; ] }
</code></pre></div><h5 id="update-第三个参数-upsert-是否在不存在的情况下进行插入"><a href="#update-第三个参数-upsert-是否在不存在的情况下进行插入" class="header-anchor">#</a> update 第三个参数 upsert（是否在不存在的情况下进行插入）</h5> <blockquote><p>db.fruit.find()
db.fruit.update({&quot;name&quot;: &quot;apple&quot;}, {$set: {&quot;count&quot;: 100}}, true)</p></blockquote> <div class="language- extra-class"><pre><code>WriteResult({
        &quot;nMatched&quot; : 0,
        &quot;nUpserted&quot; : 1,
        &quot;nModified&quot; : 0,
        &quot;_id&quot; : ObjectId(&quot;5cd6a66105b099b1e534eaed&quot;)
})
</code></pre></div><blockquote><p>db.fruit.find()</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd6a66105b099b1e534eaed&quot;), &quot;name&quot; : &quot;apple&quot;, &quot;count&quot; : 100 }
</code></pre></div><blockquote><p>db.fruit.update({&quot;name&quot;: &quot;apple&quot;}, {$set: {&quot;count&quot;: 999}}, true)
db.fruit.find()</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd6a66105b099b1e534eaed&quot;), &quot;name&quot; : &quot;apple&quot;, &quot;count&quot; : 999 }
</code></pre></div><h5 id="save-更新或创建-更新时需要指定-id"><a href="#save-更新或创建-更新时需要指定-id" class="header-anchor">#</a> save() 更新或创建（更新时需要指定 _id）</h5> <blockquote><p>db.fruit.save({&quot;name&quot;: &quot;banana&quot;, &quot;count&quot;: 10})</p></blockquote> <div class="language- extra-class"><pre><code>WriteResult({ &quot;nInserted&quot; : 1 })
</code></pre></div><blockquote><p>db.fruit.find()</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd6a66105b099b1e534eaed&quot;), &quot;name&quot; : &quot;apple&quot;, &quot;count&quot; : 999 }
{ &quot;_id&quot; : ObjectId(&quot;5cd6a6a0b2978f4bd9becafe&quot;), &quot;name&quot; : &quot;banana&quot;, &quot;count&quot; : 10 }
</code></pre></div><blockquote><p>db.fruit.save({&quot;_id&quot;: ObjectId(&quot;5cd6a6a0b2978f4bd9becafe&quot;), &quot;name&quot;: &quot;banana&quot;, &quot;count&quot;: 800})</p></blockquote> <div class="language- extra-class"><pre><code>WriteResult({ &quot;nMatched&quot; : 1, &quot;nUpserted&quot; : 0, &quot;nModified&quot; : 1 })
</code></pre></div><blockquote><p>db.fruit.find()</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd6a66105b099b1e534eaed&quot;), &quot;name&quot; : &quot;apple&quot;, &quot;count&quot; : 999 }
{ &quot;_id&quot; : ObjectId(&quot;5cd6a6a0b2978f4bd9becafe&quot;), &quot;name&quot; : &quot;banana&quot;, &quot;count&quot; : 800 }
</code></pre></div><h5 id="update-第四个参数是否更新多个文档-默认只更新找到的第一个文档"><a href="#update-第四个参数是否更新多个文档-默认只更新找到的第一个文档" class="header-anchor">#</a> update 第四个参数是否更新多个文档（默认只更新找到的第一个文档）</h5> <blockquote><p>db.fruit.find()</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd6a66105b099b1e534eaed&quot;), &quot;name&quot; : &quot;apple&quot;, &quot;count&quot; : 999 }
{ &quot;_id&quot; : ObjectId(&quot;5cd6a6a0b2978f4bd9becafe&quot;), &quot;name&quot; : &quot;banana&quot;, &quot;count&quot; : 800 }
</code></pre></div><blockquote><p>db.fruit.update({}, {$inc: {&quot;count&quot;: -100}}, false, false)</p></blockquote> <div class="language- extra-class"><pre><code>WriteResult({ &quot;nMatched&quot; : 1, &quot;nUpserted&quot; : 0, &quot;nModified&quot; : 1 })
</code></pre></div><blockquote><p>db.fruit.find()</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd6a66105b099b1e534eaed&quot;), &quot;name&quot; : &quot;apple&quot;, &quot;count&quot; : 899 }
{ &quot;_id&quot; : ObjectId(&quot;5cd6a6a0b2978f4bd9becafe&quot;), &quot;name&quot; : &quot;banana&quot;, &quot;count&quot; : 800 }
</code></pre></div><blockquote><p>db.fruit.update({}, {$inc: {&quot;count&quot;: -100}}, false, true)</p></blockquote> <div class="language- extra-class"><pre><code>WriteResult({ &quot;nMatched&quot; : 2, &quot;nUpserted&quot; : 0, &quot;nModified&quot; : 2 })
</code></pre></div><blockquote><p>db.fruit.find()</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd6a66105b099b1e534eaed&quot;), &quot;name&quot; : &quot;apple&quot;, &quot;count&quot; : 799 }
{ &quot;_id&quot; : ObjectId(&quot;5cd6a6a0b2978f4bd9becafe&quot;), &quot;name&quot; : &quot;banana&quot;, &quot;count&quot; : 700 }
</code></pre></div><blockquote><p>获取上次执行的反馈信息
db.runCommand({getLastError: 1})</p></blockquote> <div class="language- extra-class"><pre><code>{
        &quot;connectionId&quot; : 1,
        &quot;n&quot; : 0,
        &quot;syncMillis&quot; : 0,
        &quot;writtenTo&quot; : null,
        &quot;err&quot; : null,
        &quot;ok&quot; : 1
}
</code></pre></div><h4 id="查询-find-query-show-fields"><a href="#查询-find-query-show-fields" class="header-anchor">#</a> 查询 find(query, show_fields)</h4> <blockquote><p>db.food.find()</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd6ec90b2978f4bd9becaff&quot;), &quot;count&quot; : 30, &quot;name&quot; : &quot;薯条&quot; }
{ &quot;_id&quot; : ObjectId(&quot;5cd6ecb8b2978f4bd9becb00&quot;), &quot;name&quot; : &quot;炸鸡&quot;, &quot;count&quot; : 8 }
{ &quot;_id&quot; : ObjectId(&quot;5cd6ecc2b2978f4bd9becb01&quot;), &quot;name&quot; : &quot;热狗&quot;, &quot;count&quot; : 12 }
</code></pre></div><blockquote><p>第二参数指定是否输出（0 为不输出，除了 _id 外，其它需全为 1 或 0）
参考 https://www.runoob.com/mongodb/mongodb-query.html
db.food.find({}, {&quot;name&quot;: 1, &quot;_id&quot;: 0})</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;name&quot; : &quot;薯条&quot; }
{ &quot;name&quot; : &quot;炸鸡&quot; }
{ &quot;name&quot; : &quot;热狗&quot; }
</code></pre></div><blockquote><p>查询 count 小于 10
db.food.find({&quot;count&quot;: {$lt: 10}})</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd6ecb8b2978f4bd9becb00&quot;), &quot;name&quot; : &quot;炸鸡&quot;, &quot;count&quot; : 8 }
</code></pre></div><blockquote><p>查询 count 大于 10 且小于 20
db.food.find({&quot;count&quot;: {$gt: 10, $lt: 20}})</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd6ecc2b2978f4bd9becb01&quot;), &quot;name&quot; : &quot;热狗&quot;, &quot;count&quot; : 12 }
</code></pre></div><blockquote><p>查询 name 不等于 炸鸡
db.food.find({&quot;name&quot;: {$ne: &quot;炸鸡&quot;}})</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd6ec90b2978f4bd9becaff&quot;), &quot;count&quot; : 30, &quot;name&quot; : &quot;薯条&quot; }
{ &quot;_id&quot; : ObjectId(&quot;5cd6ecc2b2978f4bd9becb01&quot;), &quot;name&quot; : &quot;热狗&quot;, &quot;count&quot; : 12 }
</code></pre></div><blockquote><p>查询 name 属于在热狗、薯条之中的
db.food.find({&quot;name&quot;: {$in: [&quot;热狗&quot;, &quot;薯条&quot;]}})</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd6ec90b2978f4bd9becaff&quot;), &quot;count&quot; : 30, &quot;name&quot; : &quot;薯条&quot; }
{ &quot;_id&quot; : ObjectId(&quot;5cd6ecc2b2978f4bd9becb01&quot;), &quot;name&quot; : &quot;热狗&quot;, &quot;count&quot; : 12 }
</code></pre></div><blockquote><p>查询 name 为薯条或炸鸡
db.food.find({$or: [{&quot;name&quot;: &quot;薯条&quot;}, {&quot;name&quot;: &quot;炸鸡&quot;}]})</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd6ec90b2978f4bd9becaff&quot;), &quot;count&quot; : 30, &quot;name&quot; : &quot;薯条&quot; }
{ &quot;_id&quot; : ObjectId(&quot;5cd6ecb8b2978f4bd9becb00&quot;), &quot;name&quot; : &quot;炸鸡&quot;, &quot;count&quot; : 8 }
</code></pre></div><blockquote><p>db.food2.find()</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd6ec90b2978f4bd9becaff&quot;), &quot;count&quot; : 30, &quot;name&quot; : &quot;薯条&quot;, &quot;style&quot; : [ &quot;微辣&quot;, &quot;香辣&quot; ] }
{ &quot;_id&quot; : ObjectId(&quot;5cd6ecb8b2978f4bd9becb00&quot;), &quot;name&quot; : &quot;炸鸡&quot;, &quot;count&quot; : 8, &quot;style&quot; : [ &quot;微辣&quot;, &quot;香辣&quot; ] }
{ &quot;_id&quot; : ObjectId(&quot;5cd6ecc2b2978f4bd9becb01&quot;), &quot;name&quot; : &quot;热狗&quot;, &quot;count&quot; : 12, &quot;style&quot; : [ &quot;原味&quot; ] }
</code></pre></div><blockquote><p>查询 style 包含香辣及微辣的
db.food2.find({&quot;style&quot;: {$all: [&quot;香辣&quot;, &quot;微辣&quot;]}})</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd6ec90b2978f4bd9becaff&quot;), &quot;count&quot; : 30, &quot;name&quot; : &quot;薯条&quot;, &quot;style&quot; : [ &quot;微辣&quot;, &quot;香辣&quot; ] }
{ &quot;_id&quot; : ObjectId(&quot;5cd6ecb8b2978f4bd9becb00&quot;), &quot;name&quot; : &quot;炸鸡&quot;, &quot;count&quot; : 8, &quot;style&quot; : [ &quot;微辣&quot;, &quot;香辣&quot; ] }
</code></pre></div><blockquote><p>查询 style 只有 1 个
db.food.find({&quot;style&quot;: {$size: 1}})</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd6ecc2b2978f4bd9becb01&quot;), &quot;name&quot; : &quot;热狗&quot;, &quot;count&quot; : 12, &quot;style&quot; : [ &quot;原味&quot; ] }
</code></pre></div><blockquote><p>按 count 倒序排
db.food.find().sort({&quot;count&quot;: -1})</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd6ec90b2978f4bd9becaff&quot;), &quot;count&quot; : 30, &quot;name&quot; : &quot;薯条&quot;, &quot;style&quot; : [ &quot;微辣&quot;, &quot;香辣&quot; ] }
{ &quot;_id&quot; : ObjectId(&quot;5cd6ecc2b2978f4bd9becb01&quot;), &quot;name&quot; : &quot;热狗&quot;, &quot;count&quot; : 12, &quot;style&quot; : [ &quot;原味&quot; ] }
{ &quot;_id&quot; : ObjectId(&quot;5cd6ecb8b2978f4bd9becb00&quot;), &quot;name&quot; : &quot;炸鸡&quot;, &quot;count&quot; : 8, &quot;style&quot; : [ &quot;微辣&quot;, &quot;香辣&quot; ] }
</code></pre></div><blockquote><p>按 count 倒序排，跳过第 1 个，输出 1 个
db.food.find().sort({&quot;count&quot;: -1}).skip(1).limit(1)</p></blockquote> <div class="language- extra-class"><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5cd6ecc2b2978f4bd9becb01&quot;), &quot;name&quot; : &quot;热狗&quot;, &quot;count&quot; : 12, &quot;style&quot; : [ &quot;原味&quot; ] }
</code></pre></div><blockquote><p>格式化输出
db.food2.find().pretty()</p></blockquote> <div class="language- extra-class"><pre><code>{
        &quot;_id&quot; : ObjectId(&quot;5cd6ec90b2978f4bd9becaff&quot;),
        &quot;count&quot; : 30,
        &quot;name&quot; : &quot;薯条&quot;,
        &quot;style&quot; : [
                &quot;微辣&quot;,
                &quot;香辣&quot;
        ]
}
{
        &quot;_id&quot; : ObjectId(&quot;5cd6ecb8b2978f4bd9becb00&quot;),
        &quot;name&quot; : &quot;炸鸡&quot;,
        &quot;count&quot; : 8,
        &quot;style&quot; : [
                &quot;微辣&quot;,
                &quot;香辣&quot;
        ]
}
{
        &quot;_id&quot; : ObjectId(&quot;5cd6ecc2b2978f4bd9becb01&quot;),
        &quot;name&quot; : &quot;热狗&quot;,
        &quot;count&quot; : 12,
        &quot;style&quot; : [
                &quot;原味&quot;
        ]
}
</code></pre></div><h4 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h4> <ul><li>https://www.runoob.com/mongodb/mongodb-update.html</li> <li>https://github.com/qianjiahao/MongoDB</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/23/2020, 9:16:03 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/ODPS.html" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        ODPS
      </a></span> <span class="next"><a href="/mongodb/MongoBegin.html">
        MongoDB 起步
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> </main> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.38984056.js" defer></script><script src="/assets/js/3.3d2e4cc1.js" defer></script><script src="/assets/js/31.8c594f12.js" defer></script>
  </body>
</html>