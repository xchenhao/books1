<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>一、Node.js是什么 | 不可思议</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="xchenhao.gitee.io">
    <link rel="preload" href="/assets/css/0.styles.8dfbbd61.css" as="style"><link rel="preload" href="/assets/js/app.8afe0fb5.js" as="script"><link rel="preload" href="/assets/js/3.abed040f.js" as="script"><link rel="preload" href="/assets/js/21.74438e50.js" as="script"><link rel="prefetch" href="/assets/js/10.96817df3.js"><link rel="prefetch" href="/assets/js/11.6c8bb2c3.js"><link rel="prefetch" href="/assets/js/12.99ace30f.js"><link rel="prefetch" href="/assets/js/13.20f82e0c.js"><link rel="prefetch" href="/assets/js/14.1924f2d0.js"><link rel="prefetch" href="/assets/js/15.c5525a6f.js"><link rel="prefetch" href="/assets/js/16.6e9b32f9.js"><link rel="prefetch" href="/assets/js/17.cd2ef00e.js"><link rel="prefetch" href="/assets/js/18.518e729d.js"><link rel="prefetch" href="/assets/js/19.b3c24d12.js"><link rel="prefetch" href="/assets/js/20.dce4b112.js"><link rel="prefetch" href="/assets/js/22.4e7af791.js"><link rel="prefetch" href="/assets/js/23.4fab16ca.js"><link rel="prefetch" href="/assets/js/24.edcc99dc.js"><link rel="prefetch" href="/assets/js/25.c4d91c88.js"><link rel="prefetch" href="/assets/js/26.89e87154.js"><link rel="prefetch" href="/assets/js/27.9f1b08ba.js"><link rel="prefetch" href="/assets/js/28.5f663ef1.js"><link rel="prefetch" href="/assets/js/29.cda47e80.js"><link rel="prefetch" href="/assets/js/30.d3133add.js"><link rel="prefetch" href="/assets/js/31.c2345543.js"><link rel="prefetch" href="/assets/js/32.927edcd1.js"><link rel="prefetch" href="/assets/js/33.529346a1.js"><link rel="prefetch" href="/assets/js/34.bd2d920f.js"><link rel="prefetch" href="/assets/js/35.2180828c.js"><link rel="prefetch" href="/assets/js/36.7f1dc3ed.js"><link rel="prefetch" href="/assets/js/37.54612fec.js"><link rel="prefetch" href="/assets/js/38.4ce5c651.js"><link rel="prefetch" href="/assets/js/39.21881200.js"><link rel="prefetch" href="/assets/js/4.e1d87e2d.js"><link rel="prefetch" href="/assets/js/40.3a2cf9bf.js"><link rel="prefetch" href="/assets/js/41.4eacdb8d.js"><link rel="prefetch" href="/assets/js/42.c4bfe1a4.js"><link rel="prefetch" href="/assets/js/43.55b71d82.js"><link rel="prefetch" href="/assets/js/44.6bbf74f1.js"><link rel="prefetch" href="/assets/js/45.1ddbe73c.js"><link rel="prefetch" href="/assets/js/46.40ccd850.js"><link rel="prefetch" href="/assets/js/47.8b2bf99f.js"><link rel="prefetch" href="/assets/js/48.aa82e8c2.js"><link rel="prefetch" href="/assets/js/49.7d403bbf.js"><link rel="prefetch" href="/assets/js/5.adf1ceba.js"><link rel="prefetch" href="/assets/js/50.25db5443.js"><link rel="prefetch" href="/assets/js/51.da5401ac.js"><link rel="prefetch" href="/assets/js/52.040a1d9f.js"><link rel="prefetch" href="/assets/js/53.2d8e922e.js"><link rel="prefetch" href="/assets/js/54.350cba68.js"><link rel="prefetch" href="/assets/js/55.c2705fd0.js"><link rel="prefetch" href="/assets/js/56.682a4c32.js"><link rel="prefetch" href="/assets/js/57.8fddabc8.js"><link rel="prefetch" href="/assets/js/58.1bc92d7f.js"><link rel="prefetch" href="/assets/js/59.a1bcdd4d.js"><link rel="prefetch" href="/assets/js/6.834ebef4.js"><link rel="prefetch" href="/assets/js/60.0fb3bb65.js"><link rel="prefetch" href="/assets/js/61.b76d9f93.js"><link rel="prefetch" href="/assets/js/7.21316cb6.js"><link rel="prefetch" href="/assets/js/8.3cdf6754.js"><link rel="prefetch" href="/assets/js/9.a0c61c2b.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.f3fadfb7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8dfbbd61.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="sidebar-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="/" class="router-link-active no-logo home-link"><!----> <span class="site-name">不可思议</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          数据库
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          语言
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <!----></nav></div></div> <!----></header> <aside class="sidebar"><!----> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MySQL</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Shell</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Node.js</span> <span class="arrow down"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/nodejs/basics/01-Node.js基础.html" title="01-Node.js基础" class="active sidebar-link">01-Node.js基础</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/nodejs/basics/02-yarn.html" title="02-Yarn入门" class="sidebar-link">02-Yarn入门</a></li><li><a href="/nodejs/basics/03-Express.html" title="03-Express" class="sidebar-link">03-Express</a></li><li><a href="/nodejs/basics/04-Koa2.html" title="04-Koa2" class="sidebar-link">04-Koa2</a></li><li><a href="/nodejs/basics/05-MongoDB.html" title="05-MongoDB" class="sidebar-link">05-MongoDB</a></li><li><a href="/nodejs/basics/06-socket.html" title="06-socket编程" class="sidebar-link">06-socket编程</a></li><li><a href="/nodejs/advanced/01-Node中间件.html" title="进阶：01-Node中间件" class="sidebar-link">进阶：01-Node中间件</a></li><li><a href="/nodejs/advanced/02-Node事件循环.html" title="进阶：02-Node事件循环" class="sidebar-link">进阶：02-Node事件循环</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其它</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><a href="/books-note.html" title="读书笔记" class="sidebar-link">读书笔记</a></li><li><a href="/update_log.html" title="更新记录" class="sidebar-link">更新记录</a></li></ul></aside> <main class="page"> <div class="theme-antdocs-content content__default"><h1 id="一、node-js是什么"><a href="#一、node-js是什么" class="header-anchor">#</a> 一、Node.js是什么</h1> <p>Node.js® is a JavaScript runtime built on Chrome's V8 JavaScript engine.</p> <h3 id="_1、特性"><a href="#_1、特性" class="header-anchor">#</a> 1、特性</h3> <p>Node.js 可以解析JS代码（没有浏览器安全级别的限制）提供很多系统级别的API，如：</p> <ul><li>文件的读写 (File System)</li> <li>进程的管理 (Process)</li> <li>网络通信 (HTTP/HTTPS)</li> <li>……</li></ul> <h3 id="_2、举例"><a href="#_2、举例" class="header-anchor">#</a> 2、举例</h3> <h4 id="_2-1-浏览器安全级别的限制"><a href="#_2-1-浏览器安全级别的限制" class="header-anchor">#</a> 2.1 浏览器安全级别的限制</h4> <p><strong>Ajax测试</strong></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>browser-safe-sandbox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>browser-safe-sandbox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'https://m.maoyan.com/ajax/moreClassicList?sortId=1&amp;showType=3&amp;limit=10&amp;offset=30&amp;optimus_uuid=A5518FF0AFEC11EAAB158D7AB0D05BBBD74C9789D9F649898982E6542C7DD479&amp;optimus_risk_level=71&amp;optimus_code=10'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>浏览器预览</strong></p> <div class="language- extra-class"><pre class="language-text"><code># http://www.browsersync.cn/
browser-sync start --server --files **/* --directory
</code></pre></div><h4 id="_2-2-文件的读写-file-system"><a href="#_2-2-文件的读写-file-system" class="header-anchor">#</a> 2.2 文件的读写 (File System)</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./ajax.png'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> content</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_2-3-进程的管理-process"><a href="#_2-3-进程的管理-process" class="header-anchor">#</a> 2.3 进程的管理（Process）</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter">argv</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>运行</strong></p> <div class="language- extra-class"><pre class="language-text"><code>node 2.3-process.js argv1 argv2
</code></pre></div><h4 id="_2-4-网络通信-http-https"><a href="#_2-4-网络通信-http-https" class="header-anchor">#</a> 2.4 网络通信（HTTP/HTTPS）</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span>

http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;content-type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text/plain&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;hello nodejs&quot;</span><span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre></div><h1 id="二、node-相关工具"><a href="#二、node-相关工具" class="header-anchor">#</a> 二、Node 相关工具</h1> <h3 id="_1、nvm-node-version-manager"><a href="#_1、nvm-node-version-manager" class="header-anchor">#</a> 1、NVM: Node Version Manager</h3> <p><strong>1.1 Mac 安装 nvm</strong></p> <div class="language- extra-class"><pre class="language-text"><code>https://github.com/nvm-sh/nvm/blob/master/README.md
</code></pre></div><p><strong>1.2 Windows 安装 nvm</strong></p> <div class="language- extra-class"><pre class="language-text"><code>nvm-windows
nodist
</code></pre></div><h3 id="_2、npm-node-package-manager"><a href="#_2、npm-node-package-manager" class="header-anchor">#</a> 2、NPM: Node Package Manager</h3> <h4 id="_2-1-全局安装package"><a href="#_2-1-全局安装package" class="header-anchor">#</a> 2.1 全局安装package</h4> <div class="language- extra-class"><pre class="language-text"><code>$ npm install forever --global (-g)
$ forever
$ npm uninstall forever --global
$ forever
</code></pre></div><p><strong>全局安装包的目录</strong></p> <ul><li>Mac</li></ul> <div class="language- extra-class"><pre class="language-text"><code>/Users/felix/.nvm/versions/node/nvm各个版本/bin/
</code></pre></div><ul><li>Windows</li></ul> <div class="language- extra-class"><pre class="language-text"><code>C:\Users\你的用户名\AppData\Roaming\npm\node_modules
</code></pre></div><h4 id="_2-2-本地安装package"><a href="#_2-2-本地安装package" class="header-anchor">#</a> 2.2 本地安装package</h4> <div class="language- extra-class"><pre class="language-text"><code>$ cd ~/desktop
$ mkdir gp-project
$ cd gp-project
$ npm install underscore
$ npm list (ls)
</code></pre></div><h4 id="_2-3-package-json初始化"><a href="#_2-3-package-json初始化" class="header-anchor">#</a> 2.3 package.json初始化</h4> <div class="language- extra-class"><pre class="language-text"><code>$ pwd
$ npm init -y
$ ls
$ cat package.json
</code></pre></div><h4 id="_2-4-使用package-json"><a href="#_2-4-使用package-json" class="header-anchor">#</a> 2.4 使用package.json</h4> <div class="language- extra-class"><pre class="language-text"><code>$ npm install underscore --save
$ cat package.json
$ npm install lodash --save-dev
$ cat package.json
$ rm -rf node_modules
$ ls
$ npm install
$ npm uninstall underscore --save
$ npm list | grep underscore
$ cat package.json
</code></pre></div><h4 id="_2-5-安装指定版本的包"><a href="#_2-5-安装指定版本的包" class="header-anchor">#</a> 2.5 安装指定版本的包</h4> <div class="language- extra-class"><pre class="language-text"><code>$ pwd
$ npm list
$ npm info underscore
$ npm view underscore versions
$ npm install underscore@1.8.0
$ npm list
$ npm uninstall underscore
$ npm list
</code></pre></div><h4 id="_2-6-更新本地安装的包"><a href="#_2-6-更新本地安装的包" class="header-anchor">#</a> 2.6 更新本地安装的包</h4> <div class="language- extra-class"><pre class="language-text"><code>$ npm info underscore
$ npm view underscore versions
$ npm install underscore@1.4.4 --save-dev
$ npm list | grep gulp
$ npm outdated //~2.0.0表示patch, ^2.0.0表示minor * 表示xx最新版本
$ npm list | grep gulp
$ npm update
</code></pre></div><h4 id="_2-7-清除缓存"><a href="#_2-7-清除缓存" class="header-anchor">#</a> 2.7 清除缓存</h4> <div class="language- extra-class"><pre class="language-text"><code>npm cache clean --force
</code></pre></div><h4 id="_2-8-上传自己的包"><a href="#_2-8-上传自己的包" class="header-anchor">#</a> 2.8 上传自己的包</h4> <h6 id="_2-8-1-编写模块"><a href="#_2-8-1-编写模块" class="header-anchor">#</a> 2.8.1 编写模块</h6> <p>保存为index.js</p> <div class="language-js extra-class"><pre class="language-js"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">sayHello</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
  <span class="token keyword">return</span> <span class="token string">'Hello World'</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
</code></pre></div><h6 id="_2-8-2-初始化包描述文件"><a href="#_2-8-2-初始化包描述文件" class="header-anchor">#</a> 2.8.2 初始化包描述文件</h6> <p>$ npm init
package.json</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span> 
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;gp19-npm&quot;</span><span class="token punctuation">,</span> 
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.1&quot;</span><span class="token punctuation">,</span> 
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;gp19 self module&quot;</span><span class="token punctuation">,</span> 
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;make test&quot;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token property">&quot;repository&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Git&quot;</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;git+https://github.com/lurongtao/gp19-npm.git&quot;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> 
    <span class="token string">&quot;demo&quot;</span> 
  <span class="token punctuation">]</span><span class="token punctuation">,</span> 
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Felixlu&quot;</span><span class="token punctuation">,</span> 
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span> 
  <span class="token property">&quot;bugs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
    <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://github.com/lurongtao/gp19-npm/issues&quot;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token property">&quot;homepage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://github.com/lurongtao/gp19-npm#readme&quot;</span><span class="token punctuation">,</span> 
<span class="token punctuation">}</span> 
</code></pre></div><h6 id="_2-8-3-注册npm仓库账号"><a href="#_2-8-3-注册npm仓库账号" class="header-anchor">#</a> 2.8.3 注册npm仓库账号</h6> <div class="language- extra-class"><pre class="language-text"><code>https://www.npmjs.com 上面的账号
felix_lurt/qqmko09ijn
$ npm adduser
</code></pre></div><h6 id="_2-8-4-上传包"><a href="#_2-8-4-上传包" class="header-anchor">#</a> 2.8.4 上传包</h6> <div class="language- extra-class"><pre class="language-text"><code>$ npm publish
</code></pre></div><p>坑：403 Forbidden</p> <div class="language- extra-class"><pre class="language-text"><code>查看npm源：npm config get registry
切换npm源方法一：npm config set registry http://registry.npmjs.org
切换npm源方法二：nrm use npm
</code></pre></div><h6 id="_2-8-5-安装包"><a href="#_2-8-5-安装包" class="header-anchor">#</a> 2.8.5 安装包</h6> <div class="language- extra-class"><pre class="language-text"><code>$ npm install gp19-npm
</code></pre></div><h6 id="_2-8-6-卸载包"><a href="#_2-8-6-卸载包" class="header-anchor">#</a> 2.8.6 卸载包</h6> <div class="language- extra-class"><pre class="language-text"><code>查看当前项目引用了哪些包 ：
npm ls
卸载包：
npm unpublish --force
</code></pre></div><h6 id="_2-8-7-使用引入包"><a href="#_2-8-7-使用引入包" class="header-anchor">#</a> 2.8.7 使用引入包</h6> <div class="language- extra-class"><pre class="language-text"><code>var hello = require('gp19-npm')
hello.sayHello()
</code></pre></div><h4 id="_2-9-npm-脚本"><a href="#_2-9-npm-脚本" class="header-anchor">#</a> 2.9 npm 脚本</h4> <p>Node 开发离不开 npm，而脚本功能是 npm 最强大、最常用的功能之一。</p> <p><strong>一、什么是 npm 脚本？</strong></p> <p>npm 允许在 package.json 文件里面，使用 scripts 字段定义脚本命令。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node build.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>二、执行顺序</strong></p> <p>如果 npm 脚本里面需要执行多个任务，那么需要明确它们的执行顺序。</p> <p>script1.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">0</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
</code></pre></div><p>script2.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token number">0</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>
</code></pre></div><div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;script1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node script1.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;script2&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node script2.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果是并行执行（即同时的平行执行），可以使用 <code>&amp;</code> 符号。</p> <div class="language- extra-class"><pre class="language-text"><code>$ npm run script1 &amp; npm run script2
</code></pre></div><p>如果是继发执行（即只有前一个任务成功，才执行下一个任务），可以使用 <code>&amp;&amp;</code> 符号。</p> <div class="language- extra-class"><pre class="language-text"><code>$ npm run script1 &amp;&amp; npm run script2
</code></pre></div><p><strong>三、简写形式</strong></p> <p>常用的 npm 脚本简写形式。</p> <div class="language- extra-class"><pre class="language-text"><code>npm start 是 npm run start
</code></pre></div><p><strong>四、变量</strong></p> <p>npm 脚本有一个非常强大的功能，就是可以使用 npm 的内部变量。</p> <p>首先，通过 <code>npm_package_</code> 前缀，npm 脚本可以拿到 package.json 里面的字段。比如，下面是一个 package.json。</p> <blockquote><p>注意：一定要在 npm 脚本中运行（如：npm run view）才可以，直接在命令行中运行JS（如：node view.js）是拿不到值的</p></blockquote> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> 
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.2.5&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;view&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node view.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>那么，变量 npm_package_name 返回 foo，变量 npm_package_version 返回 1.2.5。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// view.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>npm_package_name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// foo</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>npm_package_version<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1.2.5</span>
</code></pre></div><p>上面代码中，我们通过环境变量 process.env 对象，拿到 package.json 的字段值。如果是 Bash 脚本，可以用$npm_package_name 和 $npm_package_version 取到这两个值。</p> <p>npm_package_前缀也支持嵌套的package.json字段。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;repository&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;git&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xxx&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
scripts<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;view&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo $npm_package_repository_type&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面代码中，repository 字段的 type 属性，可以通过 npm_package_repository_type 取到。</p> <p>下面是另外一个例子。</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;scripts&quot;: {
  &quot;install&quot;: &quot;foo.js&quot;
}
</code></pre></div><p>上面代码中，npm_package_scripts_install 变量的值等于 foo.js。</p> <p>然后，npm 脚本还可以通过 npm_config_ 前缀，拿到 npm 的配置变量，即 npm config get xxx 命令返回的值。比如，当前模块的发行标签，可以通过 npm_config_tag 取到。</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;view&quot;: &quot;echo $npm_config_tag&quot;,
</code></pre></div><p>注意，package.json 里面的 config 对象，可以被环境变量覆盖。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span> 
  <span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;config&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;port&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;8080&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;start&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;node server.js&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面代码中，npm_package_config_port 变量返回的是 8080。这个值可以用下面的方法覆盖。</p> <div class="language- extra-class"><pre class="language-text"><code>$ npm config set foo:port 80
</code></pre></div><p>最后，env命令可以列出所有环境变量。</p> <p>&quot;env&quot;: &quot;env&quot;</p> <h4 id="_2-10-npm-安装-git-上发布的包"><a href="#_2-10-npm-安装-git-上发布的包" class="header-anchor">#</a> 2.10 npm 安装 git 上发布的包</h4> <div class="language- extra-class"><pre class="language-text"><code># 这样适合安装公司内部的git服务器上的项目
npm install git+https://git@github.com:lurongtao/gp-project.git

# 或者以ssh的方式
npm install git+ssh://git@github.com:lurongtao/gp-project.git
</code></pre></div><h4 id="_2-11-cross-env-使用"><a href="#_2-11-cross-env-使用" class="header-anchor">#</a> 2.11 cross-env 使用</h4> <h5 id="_2-11-1-cross-env是什么"><a href="#_2-11-1-cross-env是什么" class="header-anchor">#</a> 2.11.1 cross-env是什么</h5> <p>运行跨平台设置和使用环境变量的脚本</p> <h5 id="_2-11-2-出现原因"><a href="#_2-11-2-出现原因" class="header-anchor">#</a> 2.11.2 出现原因</h5> <p>当您使用 NODE_ENV=production, 来设置环境变量时，大多数 Windows 命令提示将会阻塞(报错)。（异常是Windows上的Bash，它使用本机Bash。）换言之，Windows 不支持 NODE_ENV=production 的设置方式。</p> <h5 id="_2-11-3-解决"><a href="#_2-11-3-解决" class="header-anchor">#</a> 2.11.3 解决</h5> <p>cross-env 使得您可以使用单个命令，而不必担心为平台正确设置或使用环境变量。这个迷你的包(cross-env)能够提供一个设置环境变量的 scripts，让你能够以 Unix 方式设置环境变量，然后在 Windows 上也能兼容运行。</p> <h5 id="_2-11-4-安装"><a href="#_2-11-4-安装" class="header-anchor">#</a> 2.11.4 安装</h5> <p>npm install --save-dev cross-env</p> <h5 id="_2-11-5-使用"><a href="#_2-11-5-使用" class="header-anchor">#</a> 2.11.5 使用</h5> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production webpack --config build/webpack.config.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>NODE_ENV环境变量将由 cross-env 设置
打印 process.env.NODE_ENV === 'production'</p> <h3 id="_3、nrm-npm-registry-manager"><a href="#_3、nrm-npm-registry-manager" class="header-anchor">#</a> 3、NRM: npm registry manager</h3> <h4 id="_3-1-手工切换源"><a href="#_3-1-手工切换源" class="header-anchor">#</a> 3.1 手工切换源</h4> <h5 id="_3-1-1-查看当前源"><a href="#_3-1-1-查看当前源" class="header-anchor">#</a> 3.1.1 查看当前源</h5> <div class="language- extra-class"><pre class="language-text"><code>npm config get registry
</code></pre></div><h5 id="_3-1-2-切换淘宝源"><a href="#_3-1-2-切换淘宝源" class="header-anchor">#</a> 3.1.2 切换淘宝源</h5> <div class="language- extra-class"><pre class="language-text"><code>npm config set registry https://registry.npm.taobao.org
</code></pre></div><h4 id="_3-2-nrm-管理源"><a href="#_3-2-nrm-管理源" class="header-anchor">#</a> 3.2 NRM 管理源</h4> <p>NRM (npm registry manager)是npm的镜像源管理工具，有时候国外资源太慢，使用这个就可以快速地在 npm 源间切换。</p> <h5 id="_3-2-1-安装-nrm"><a href="#_3-2-1-安装-nrm" class="header-anchor">#</a> 3.2.1 安装 nrm</h5> <p>在命令行执行命令，npm install -g nrm，全局安装nrm。</p> <h5 id="_3-2-2-使用-nrm"><a href="#_3-2-2-使用-nrm" class="header-anchor">#</a> 3.2.2 使用 nrm</h5> <p>执行命令 nrm ls 查看可选的源。
其中，带*的是当前使用的源，上面的输出表明当前源是官方源。</p> <h5 id="_3-2-3-切换-nrm"><a href="#_3-2-3-切换-nrm" class="header-anchor">#</a> 3.2.3 切换 nrm</h5> <p>如果要切换到taobao源，执行命令nrm use taobao。</p> <h5 id="_3-2-4-测试速度"><a href="#_3-2-4-测试速度" class="header-anchor">#</a> 3.2.4 测试速度</h5> <p>你还可以通过 nrm test 测试相应源的响应时间。</p> <div class="language- extra-class"><pre class="language-text"><code>nrm test
</code></pre></div><h3 id="_4、npx-npm-package-extention"><a href="#_4、npx-npm-package-extention" class="header-anchor">#</a> 4、NPX: npm package extention</h3> <p>npm 从5.2版开始，增加了 npx 命令。它有很多用处，本文介绍该命令的主要使用场景。</p> <p>Node 自带 npm 模块，所以可以直接使用 npx 命令。万一不能用，就要手动安装一下。</p> <div class="language- extra-class"><pre class="language-text"><code>$ npm install -g npx
</code></pre></div><h4 id="_4-1-调用项目安装的模块"><a href="#_4-1-调用项目安装的模块" class="header-anchor">#</a> 4.1 调用项目安装的模块</h4> <p>npx 想要解决的主要问题，就是调用项目内部安装的模块。比如，项目内部安装了Mocha。</p> <div class="language- extra-class"><pre class="language-text"><code>$ npm install -D mocha
</code></pre></div><p>一般来说，调用 Mocha ，只能在项目脚本和 package.json 的scripts字段里面，如果想在命令行下调用，必须像下面这样。</p> <div class="language- extra-class"><pre class="language-text"><code># 项目的根目录下执行
$ node-modules/.bin/mocha --version
</code></pre></div><p>npx 就是想解决这个问题，让项目内部安装的模块用起来更方便，只要像下面这样调用就行了。</p> <div class="language- extra-class"><pre class="language-text"><code>$ npx mocha --version
</code></pre></div><p>npx 的原理很简单，就是运行的时候，会到node_modules/.bin路径和环境变量$PATH里面，检查命令是否存在。</p> <p>由于 npx 会检查环境变量$PATH，所以系统命令也可以调用。</p> <div class="language- extra-class"><pre class="language-text"><code># 等同于 ls
$ npx ls
</code></pre></div><p>注意，Bash 内置的命令不在$PATH里面，所以不能用。比如，cd是 Bash 命令，因此就不能用npx cd。</p> <h4 id="_4-2-避免全局安装模块"><a href="#_4-2-避免全局安装模块" class="header-anchor">#</a> 4.2 避免全局安装模块</h4> <p>除了调用项目内部模块，npx 还能避免全局安装的模块。比如，create-react-app 这个模块是全局安装，npx 可以运行它，而且不进行全局安装。</p> <div class="language- extra-class"><pre class="language-text"><code>$ npx create-react-app my-react-app
</code></pre></div><p>上面代码运行时，npx 将 create-react-app 下载到一个临时目录，使用以后再删除。所以，以后再次执行上面的命令，会重新下载 create-react-app。</p> <p>注意，只要 npx 后面的模块无法在本地发现，就会下载同名模块。比如，本地没有安装http-server模块，下面的命令会自动下载该模块，在当前目录启动一个 Web 服务。</p> <div class="language- extra-class"><pre class="language-text"><code>$ npx http-server
</code></pre></div><h4 id="_4-3-no-install-参数和-ignore-existing-参数"><a href="#_4-3-no-install-参数和-ignore-existing-参数" class="header-anchor">#</a> 4.3 --no-install 参数和 --ignore-existing 参数</h4> <p>如果想让 npx 强制使用本地模块，不下载远程模块，可以使用--no-install参数。如果本地不存在该模块，就会报错。</p> <div class="language- extra-class"><pre class="language-text"><code>$ npx --no-install http-server
</code></pre></div><p>反过来，如果忽略本地的同名模块，强制安装使用远程模块，可以使用--ignore-existing参数。比如，本地已经安装了http-server，但还是想使用远程模块，就用这个参数。</p> <div class="language- extra-class"><pre class="language-text"><code>$ npx --ignore-existing http-server
</code></pre></div><h1 id="三、模块-包-与-commonjs"><a href="#三、模块-包-与-commonjs" class="header-anchor">#</a> 三、模块/包 与 CommonJS</h1> <h3 id="_1、模块-包分类"><a href="#_1、模块-包分类" class="header-anchor">#</a> 1、模块/包分类</h3> <p>Node.js 有三类模块，即内置的模块、第三方的模块、自定义的模块。</p> <h4 id="_1-1-内置的模块"><a href="#_1-1-内置的模块" class="header-anchor">#</a> 1.1 内置的模块</h4> <p>Node.js 内置模块又叫核心模块，Node.js安装完成可直接使用。如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> extname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>extname<span class="token punctuation">)</span>
</code></pre></div><h4 id="_1-2-第三方的node-js模块"><a href="#_1-2-第三方的node-js模块" class="header-anchor">#</a> 1.2 第三方的Node.js模块</h4> <p>第三方的Node.js模块指的是为了实现某些功能，发布的npmjs.org上的模块，按照一定的开源协议供社群使用。如：</p> <div class="language- extra-class"><pre class="language-text"><code>npm install chalk
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> chalk <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chalk'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">blue</span><span class="token punctuation">(</span><span class="token string">'Hello world!'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_1-3-自定义的node-js模块"><a href="#_1-3-自定义的node-js模块" class="header-anchor">#</a> 1.3 自定义的Node.js模块</h4> <p>自定义的Node.js模块，也叫文件模块，是我们自己写的供自己使用的模块。同时，这类模块发布到npmjs.org上就成了开源的第三方模块。</p> <p>自定义模块是在运行时动态加载，需要完整的路径分析、文件定位、编译执行过程、速度相比核心模块稍微慢一些，但是用的非常多。</p> <h5 id="_1-3-1-模块定义、接口暴露和引用接口"><a href="#_1-3-1-模块定义、接口暴露和引用接口" class="header-anchor">#</a> 1.3.1 模块定义、接口暴露和引用接口</h5> <p>我们可以把公共的功能 抽离成为一个单独的 js  文件 作为一个模块，默认情况下面这个模块里面的方法或者属性，外面是没法访问的。如果要让外部可以访问模块里面的方法或者属性，就必须在模块里面通过 exports 或者 module.exports 暴露属性或者方法。</p> <p>m1.js：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'gp19'</span>

<span class="token keyword">const</span> <span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'module 1'</span><span class="token punctuation">)</span>

<span class="token comment">// 接口暴露方法一：</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  say<span class="token operator">:</span> sayName
<span class="token punctuation">}</span>

<span class="token comment">// 接口暴露方法二：</span>
exports<span class="token punctuation">.</span>say <span class="token operator">=</span> sayName

<span class="token comment">// 错误！</span>
exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  say<span class="token operator">:</span> sayName
<span class="token punctuation">}</span>
</code></pre></div><p>main.js：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> m1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./m1'</span><span class="token punctuation">)</span>
m1<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h5 id="_1-3-2-模块的循环引用"><a href="#_1-3-2-模块的循环引用" class="header-anchor">#</a> 1.3.2 模块的循环引用</h5> <p>由于 exports 使用方式方式不对，会在两个不同 js 循环引用的情况下，导致其中一个 js 无法获取另外一个 js 的方法，从而导致执行报错。如：</p> <ul><li>a.js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>exports<span class="token punctuation">.</span>done <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./b.js'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'in a, b.done = %j'</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span>done<span class="token punctuation">)</span>
exports<span class="token punctuation">.</span>done <span class="token operator">=</span> <span class="token boolean">true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a done'</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>b.js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'b starting'</span><span class="token punctuation">)</span>
exports<span class="token punctuation">.</span>done <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./a.js'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'in b, a.done = %j'</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>done<span class="token punctuation">)</span>
exports<span class="token punctuation">.</span>done <span class="token operator">=</span> <span class="token boolean">true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'b done'</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>main.js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'main starting'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./a.js'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./b.js'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'in main, a.done = %j, b.done = %j'</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>done<span class="token punctuation">,</span> b<span class="token punctuation">.</span>done<span class="token punctuation">)</span>
</code></pre></div><p>main.js 首先会 load a.js, 此时执行到const b = require('./b.js');的时候，程序会转去loadb.js, 在b.js中执行到const a = require('./a.js'); 为了防止无限循环，将a.jsexports的未完成副本返回到b.js模块。然后b.js完成加载，并将其导出对象提供给a.js模块。</p> <p>我们知道nodeJs的对每个js文件进行了一层包装称为module，module中有一个属性exports，当调用require('a.js')的时候其实返回的是module.exports对象，module.exports初始化为一个{}空的object，所以在上面的例子中，执行到b.js中const a = require('./a.js');时不会load新的a module, 而是将已经load但是还未完成的a module的exports属性返回给b module，所以b.js拿到的是a module的exports对象，即：{done:false}, 虽然在a.js中exports.done被修改成了true，但是由于此时a.js未load完成，所以在b.js输出的a module的属性done为false，而在main.js中输出的a module的属性done为true. Nodejs通过上面这种返回未完成exports对象来解决循环引用的问题。</p> <h1 id="四、常用内置模块"><a href="#四、常用内置模块" class="header-anchor">#</a> 四、常用内置模块</h1> <p>这里介绍几个常用的内置模块：url, querystring, http, events, fs, stream, readline, crypto, zlib</p> <h3 id="_1、url"><a href="#_1、url" class="header-anchor">#</a> 1、url</h3> <h4 id="_1-1-parse"><a href="#_1-1-parse" class="header-anchor">#</a> 1.1 parse</h4> <p>url.parse(urlString[, parseQueryString[, slashesDenoteHost]])</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> urlString <span class="token operator">=</span> <span class="token string">'https://www.baidu.com:443/ad/index.html?id=8&amp;name=mouse#tag=110'</span>
<span class="token keyword">const</span> parsedStr <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>urlString<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>parsedStr<span class="token punctuation">)</span>
</code></pre></div><h4 id="_1-2-format"><a href="#_1-2-format" class="header-anchor">#</a> 1.2 format</h4> <p>url.format(urlObject)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> urlObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  protocol<span class="token operator">:</span> <span class="token string">'https:'</span><span class="token punctuation">,</span>
  slashes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  auth<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  host<span class="token operator">:</span> <span class="token string">'www.baidu.com:443'</span><span class="token punctuation">,</span>
  port<span class="token operator">:</span> <span class="token string">'443'</span><span class="token punctuation">,</span>
  hostname<span class="token operator">:</span> <span class="token string">'www.baidu.com'</span><span class="token punctuation">,</span>
  hash<span class="token operator">:</span> <span class="token string">'#tag=110'</span><span class="token punctuation">,</span>
  search<span class="token operator">:</span> <span class="token string">'?id=8&amp;name=mouse'</span><span class="token punctuation">,</span>
  query<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'8'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'mouse'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  pathname<span class="token operator">:</span> <span class="token string">'/ad/index.html'</span><span class="token punctuation">,</span>
  path<span class="token operator">:</span> <span class="token string">'/ad/index.html?id=8&amp;name=mouse'</span><span class="token punctuation">,</span>
  href<span class="token operator">:</span> <span class="token string">'https://www.baidu.com:443/ad/index.html?id=8&amp;name=mouse#tag=110'</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> parsedObj <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>urlObject<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>parsedObj<span class="token punctuation">)</span>
</code></pre></div><h4 id="_1-3-resolve"><a href="#_1-3-resolve" class="header-anchor">#</a> 1.3 resolve</h4> <p>url.resolve(from, to)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'/one/two/three'</span><span class="token punctuation">,</span> <span class="token string">'four'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'http://example.com/'</span><span class="token punctuation">,</span> <span class="token string">'/one'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> c <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'http://example.com/one'</span><span class="token punctuation">,</span> <span class="token string">'/two'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> b <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> c<span class="token punctuation">)</span>
</code></pre></div><h3 id="_2、querystring"><a href="#_2、querystring" class="header-anchor">#</a> 2、querystring</h3> <h4 id="_2-1-parse"><a href="#_2-1-parse" class="header-anchor">#</a> 2.1 parse</h4> <p>querystring.parse(str[, sep[, eq[, options]]])</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> qs <span class="token operator">=</span> <span class="token string">'x=3&amp;y=4'</span>
<span class="token keyword">var</span> parsed <span class="token operator">=</span> querystring<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>qs<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>parsed<span class="token punctuation">)</span>
</code></pre></div><h4 id="_2-2-stringify"><a href="#_2-2-stringify" class="header-anchor">#</a> 2.2 stringify</h4> <p>querystring.stringify(obj[, sep[, eq[, options]]])</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> qo <span class="token operator">=</span> <span class="token punctuation">{</span>
  x<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  y<span class="token operator">:</span> <span class="token number">4</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> parsed <span class="token operator">=</span> querystring<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>qo<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>parsed<span class="token punctuation">)</span>
</code></pre></div><h4 id="_2-3-escape-unescape"><a href="#_2-3-escape-unescape" class="header-anchor">#</a> 2.3 escape/unescape</h4> <p>querystring.escape(str)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">'id=3&amp;city=北京&amp;url=https://www.baidu.com'</span>
<span class="token keyword">var</span> escaped <span class="token operator">=</span> querystring<span class="token punctuation">.</span><span class="token function">escape</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>escaped<span class="token punctuation">)</span>
</code></pre></div><p>querystring.unescape(str)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">'id%3D3%26city%3D%E5%8C%97%E4%BA%AC%26url%3Dhttps%3A%2F%2Fwww.baidu.com'</span>
<span class="token keyword">var</span> unescaped <span class="token operator">=</span> querystring<span class="token punctuation">.</span><span class="token function">unescape</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>unescaped<span class="token punctuation">)</span>
</code></pre></div><h3 id="_3、http-https"><a href="#_3、http-https" class="header-anchor">#</a> 3、http/https</h3> <h4 id="_3-1-get"><a href="#_3-1-get" class="header-anchor">#</a> 3.1 get</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> https <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'https'</span><span class="token punctuation">)</span>

<span class="token comment">// 1、接口 2、跨域</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> url <span class="token operator">=</span> request<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  
  <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token string">''</span>

  response<span class="token punctuation">.</span><span class="token function">writeHeader</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token string">'content-type'</span><span class="token operator">:</span> <span class="token string">'application/json;charset=utf-8'</span><span class="token punctuation">,</span>
    <span class="token string">'Access-Control-Allow-Origin'</span><span class="token operator">:</span> <span class="token string">'*'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  https<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://m.lagou.com/listmore.json</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      data <span class="token operator">+=</span> chunk
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        ret<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        data
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'localhost:8080'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_3-2-post-服务器提交-攻击"><a href="#_3-2-post-服务器提交-攻击" class="header-anchor">#</a> 3.2 post：服务器提交（攻击）</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> https <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'https'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> postData <span class="token operator">=</span> querystring<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  province<span class="token operator">:</span> <span class="token string">'上海'</span><span class="token punctuation">,</span>
  city<span class="token operator">:</span> <span class="token string">'上海'</span><span class="token punctuation">,</span>
  district<span class="token operator">:</span> <span class="token string">'宝山区'</span><span class="token punctuation">,</span>
  address<span class="token operator">:</span> <span class="token string">'同济支路199号智慧七立方3号楼2-4层'</span><span class="token punctuation">,</span>
  latitude<span class="token operator">:</span> <span class="token number">43.0</span><span class="token punctuation">,</span>
  longitude<span class="token operator">:</span> <span class="token number">160.0</span><span class="token punctuation">,</span>
  message<span class="token operator">:</span> <span class="token string">'求购一条小鱼'</span><span class="token punctuation">,</span>
  contact<span class="token operator">:</span> <span class="token string">'13666666'</span><span class="token punctuation">,</span>
  type<span class="token operator">:</span> <span class="token string">'sell'</span><span class="token punctuation">,</span>
  time<span class="token operator">:</span> <span class="token number">1571217561</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  protocol<span class="token operator">:</span> <span class="token string">'https:'</span><span class="token punctuation">,</span>
  hostname<span class="token operator">:</span> <span class="token string">'ik9hkddr.qcloud.la'</span><span class="token punctuation">,</span>
  method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  port<span class="token operator">:</span> <span class="token number">443</span><span class="token punctuation">,</span>
  path<span class="token operator">:</span> <span class="token string">'/index.php/trade/add_item'</span><span class="token punctuation">,</span>
  headers<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">,</span>
    <span class="token string">'Content-Length'</span><span class="token operator">:</span> Buffer<span class="token punctuation">.</span><span class="token function">byteLength</span><span class="token punctuation">(</span>postData<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> data
  
  <span class="token keyword">let</span> req <span class="token operator">=</span> https<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token parameter">chunk</span> <span class="token operator">=&gt;</span> data <span class="token operator">+=</span> chunk<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  
  req<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>postData<span class="token punctuation">)</span>
  req<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// setInterval(() =&gt; {</span>
<span class="token comment">//   doPost()</span>
<span class="token comment">// }, 1000)</span>
</code></pre></div><h4 id="_3-3-跨域-jsonp"><a href="#_3-3-跨域-jsonp" class="header-anchor">#</a> 3.3 跨域：jsonp</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> urlObj <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>

  <span class="token keyword">switch</span> <span class="token punctuation">(</span>urlObj<span class="token punctuation">.</span>pathname<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'/api/user'</span><span class="token operator">:</span>
      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>urlObj<span class="token punctuation">.</span>query<span class="token punctuation">.</span>cb<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">({&quot;name&quot;: &quot;gp145&quot;})</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token keyword">break</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'404.'</span><span class="token punctuation">)</span>
      <span class="token keyword">break</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'localhost:8080'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_3-4-跨域-cors"><a href="#_3-4-跨域-cors" class="header-anchor">#</a> 3.4 跨域：CORS</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">''</span>
  <span class="token keyword">let</span> urlObj <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>

  res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token string">'content-type'</span><span class="token operator">:</span> <span class="token string">'application/json;charset=utf-8'</span><span class="token punctuation">,</span>
    <span class="token string">'Access-Control-Allow-Origin'</span><span class="token operator">:</span> <span class="token string">'*'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    data <span class="token operator">+=</span> chunk
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">responseResult</span><span class="token punctuation">(</span>querystring<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">function</span> <span class="token function">responseResult</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>urlObj<span class="token punctuation">.</span>pathname<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">'/api/login'</span><span class="token operator">:</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          message<span class="token operator">:</span> data
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'404.'</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'localhost:8080'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_3-5-跨域-middleware-http-proxy-middware"><a href="#_3-5-跨域-middleware-http-proxy-middware" class="header-anchor">#</a> 3.5 跨域：middleware（http-proxy-middware）</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http-proxy-middleware'</span><span class="token punctuation">)</span>

http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> url <span class="token operator">=</span> req<span class="token punctuation">.</span>url

  res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token string">'Access-Control-Allow-Origin'</span><span class="token operator">:</span> <span class="token string">'*'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\/api</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> apiProxy <span class="token operator">=</span> <span class="token function">proxy</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> 
      target<span class="token operator">:</span> <span class="token string">'https://m.lagou.com'</span><span class="token punctuation">,</span>
      changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'^/api'</span><span class="token operator">:</span> <span class="token string">''</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  
    <span class="token comment">// http-proy-middleware 在Node.js中使用的方法</span>
    <span class="token function">apiProxy</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">'/index.html'</span><span class="token operator">:</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
      <span class="token keyword">case</span> <span class="token string">'/search.html'</span><span class="token operator">:</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'search.html'</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'[404]page not found.'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_3-6-爬虫"><a href="#_3-6-爬虫" class="header-anchor">#</a> 3.6 爬虫</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> https <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'https'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> cheerio <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cheerio'</span><span class="token punctuation">)</span>

http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token string">'content-type'</span><span class="token operator">:</span> <span class="token string">'application/json;charset=utf-8'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    protocol<span class="token operator">:</span> <span class="token string">'https:'</span><span class="token punctuation">,</span>
    hostname<span class="token operator">:</span> <span class="token string">'maoyan.com'</span><span class="token punctuation">,</span>
    port<span class="token operator">:</span> <span class="token number">443</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
    method<span class="token operator">:</span> <span class="token string">'GET'</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">const</span> req <span class="token operator">=</span> https<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">''</span>
    res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      data <span class="token operator">+=</span> chunk
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  
    res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">filterData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  
  <span class="token keyword">function</span> <span class="token function">filterData</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> $ <span class="token operator">=</span> cheerio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">let</span> $movieList <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.movie-item'</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> movies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    $movieList<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      movies<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        title<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.movie-title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        score<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.movie-score i'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>movies<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  req<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">9000</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_4、events"><a href="#_4、events" class="header-anchor">#</a> 4、Events</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">MyEventEmitter</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">const</span> event <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyEventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

event<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'play'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">movie</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>movie<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

event<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'play'</span><span class="token punctuation">,</span> <span class="token string">'我和我的祖国'</span><span class="token punctuation">)</span>
event<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'play'</span><span class="token punctuation">,</span> <span class="token string">'中国机长'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_5、file-system"><a href="#_5、file-system" class="header-anchor">#</a> 5、File System</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fsP <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>promises

<span class="token comment">// 创建文件夹</span>
fs<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token string">'./logs'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'done.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 文件夹改名</span>
fs<span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token string">'./logs'</span><span class="token punctuation">,</span> <span class="token string">'./log'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'done'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 删除文件夹</span>
fs<span class="token punctuation">.</span><span class="token function">rmdir</span><span class="token punctuation">(</span><span class="token string">'./log'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'done.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 写内容到文件里</span>
fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>
  <span class="token string">'./logs/log1.txt'</span><span class="token punctuation">,</span>
  <span class="token string">'hello'</span><span class="token punctuation">,</span>
  <span class="token comment">// 错误优先的回调函数</span>
  <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件创建成功'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">// 给文件追加内容</span>
fs<span class="token punctuation">.</span><span class="token function">appendFile</span><span class="token punctuation">(</span><span class="token string">'./logs/log1.txt'</span><span class="token punctuation">,</span> <span class="token string">'\nworld'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'done.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 读取文件内容</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./logs/log1.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 删除文件</span>
fs<span class="token punctuation">.</span><span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string">'./logs/log1.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'done.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 批量写文件</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./logs/log-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.txt</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">log-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'done.'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 读取文件/目录信息</span>
fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span><span class="token string">'./'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// console.log(value + ':' + stats.size)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value <span class="token operator">+</span> <span class="token string">' is '</span> <span class="token operator">+</span> <span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">'directory'</span> <span class="token operator">:</span> <span class="token string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 同步读取文件</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./logs/log-1.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment">// 异步读取文件：方法一</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./logs/log-0.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> content</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment">// 异步读取文件：方法二</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./logs/log-0.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 异步读取文件：方法三</span>
<span class="token keyword">function</span> <span class="token function">getFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./logs/log-0.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">getFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 异步读取文件：方法四</span>
<span class="token keyword">const</span> fsp <span class="token operator">=</span> fsP<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./logs/log-1.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fsP<span class="token punctuation">)</span>

<span class="token comment">// watch 监测文件变化</span>
fs<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'./logs/log-0.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_6、stream"><a href="#_6、stream" class="header-anchor">#</a> 6、Stream</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> readstream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'./note.txt'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> writestream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'./note2.txt'</span><span class="token punctuation">)</span>

writestream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>readstream<span class="token punctuation">)</span>
</code></pre></div><h3 id="_7、zlib"><a href="#_7、zlib" class="header-anchor">#</a> 7、Zlib</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> zlib <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'zlib'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> gzip <span class="token operator">=</span> zlib<span class="token punctuation">.</span><span class="token function">createGzip</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> readstream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'./note.txt'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> writestream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'./note2.txt'</span><span class="token punctuation">)</span>

readstream
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gzip<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writestream<span class="token punctuation">)</span>

writestream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>readstream<span class="token punctuation">)</span>
</code></pre></div><h3 id="_8、readline"><a href="#_8、readline" class="header-anchor">#</a> 8、ReadLine</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> readline <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'readline'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> rl <span class="token operator">=</span> readline<span class="token punctuation">.</span><span class="token function">createInterface</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  input<span class="token operator">:</span> process<span class="token punctuation">.</span>stdin<span class="token punctuation">,</span>
  output<span class="token operator">:</span> process<span class="token punctuation">.</span>stdout
<span class="token punctuation">}</span><span class="token punctuation">)</span>

rl<span class="token punctuation">.</span><span class="token function">question</span><span class="token punctuation">(</span><span class="token string">'What do you think of Node.js? '</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">answer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// TODO: Log the answer in a database</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Thank you for your valuable feedback: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>answer<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

  rl<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_9、crypto"><a href="#_9、crypto" class="header-anchor">#</a> 9、Crypto</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> secret <span class="token operator">=</span> <span class="token string">'abcdefg'</span>
<span class="token keyword">const</span> hash <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">createHmac</span><span class="token punctuation">(</span><span class="token string">'sha256'</span><span class="token punctuation">,</span> secret<span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">'I love you'</span><span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>hash<span class="token punctuation">)</span>
</code></pre></div><h1 id="四、路由"><a href="#四、路由" class="header-anchor">#</a> 四、路由</h1> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span> <span class="token keyword">function</span> <span class="token punctuation">(</span> <span class="token parameter">req<span class="token punctuation">,</span> res</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">switch</span> <span class="token punctuation">(</span> req<span class="token punctuation">.</span>url <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'/home'</span><span class="token operator">:</span>
      res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'home'</span><span class="token punctuation">)</span>
      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">break</span>
    <span class="token keyword">case</span> <span class="token string">'/mine'</span><span class="token operator">:</span>
      res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'mine'</span><span class="token punctuation">)</span>
      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">break</span>
    <span class="token keyword">case</span> <span class="token string">'/login'</span><span class="token operator">:</span> 
      fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span> <span class="token string">'./static/login.html'</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span> <span class="token parameter">error <span class="token punctuation">,</span> data</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> error <span class="token punctuation">)</span> <span class="token keyword">throw</span> error  
        res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span> data <span class="token punctuation">)</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">break</span>
    <span class="token keyword">case</span> <span class="token string">'/fulian.jpg'</span><span class="token operator">:</span>
      fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span> <span class="token string">'./static/fulian.jpg'</span><span class="token punctuation">,</span> <span class="token string">'binary'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">error <span class="token punctuation">,</span> data</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> error <span class="token punctuation">)</span> <span class="token keyword">throw</span> error 
        res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span> data<span class="token punctuation">,</span> <span class="token string">'binary'</span> <span class="token punctuation">)</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">break</span>
    <span class="token keyword">default</span><span class="token operator">:</span> 
      <span class="token keyword">break</span>
   <span class="token punctuation">}</span>

 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span> <span class="token number">8000</span><span class="token punctuation">,</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'服务器运行在： http://localhost:8000'</span> <span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h1 id="五、静态资源服务"><a href="#五、静态资源服务" class="header-anchor">#</a> 五、静态资源服务</h1> <h3 id="_5-1-readstaticfile"><a href="#_5-1-readstaticfile" class="header-anchor">#</a> 5.1 readStaticFile</h3> <p>/modules/readStaticFile.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 引入依赖的模块</span>
<span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> mime <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mime'</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">readStaticFile</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> filePathname</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">var</span> ext <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>filePathname<span class="token punctuation">)</span><span class="token punctuation">.</span>ext
  <span class="token keyword">var</span> mimeType <span class="token operator">=</span> mime<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span>ext<span class="token punctuation">)</span>

  <span class="token comment">// 判断路径是否有后缀, 有的话则说明客户端要请求的是一个文件 </span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 根据传入的目标文件路径来读取对应文件</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>filePathname<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 错误处理</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text/plain&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;404 - NOT FOUND&quot;</span><span class="token punctuation">)</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">&quot;Content-Type&quot;</span><span class="token operator">:</span> mimeType <span class="token punctuation">}</span><span class="token punctuation">)</span>
        res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 返回 true 表示, 客户端想要的 是 静态文件</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 返回 false 表示, 客户端想要的 不是 静态文件</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 导出函数</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> readStaticFile
</code></pre></div><h3 id="_5-2-server"><a href="#_5-2-server" class="header-anchor">#</a> 5.2 server</h3> <p>/server.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 引入相关模块</span>
<span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> readStaticFile <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./modules/readStaticFile'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 搭建 HTTP 服务器</span>
<span class="token keyword">var</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> urlObj <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> urlPathname <span class="token operator">=</span> urlObj<span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>
  <span class="token keyword">var</span> filePathname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;/public&quot;</span><span class="token punctuation">,</span> urlPathname<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 读取静态文件</span>
  <span class="token function">readStaticFile</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> filePathname<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 在 3000 端口监听请求</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;服务器运行中.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;正在监听 3000 端口:&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_5-3-最终目录结构"><a href="#_5-3-最终目录结构" class="header-anchor">#</a> 5.3 最终目录结构</h3> <img src="/assets/img/dir.1acebd98.jpg" width="300"></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/12/2021, 7:40:15 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/grep-sed-awk.html" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        grep &amp; sed &amp; awk
      </a></span> <span class="next"><a href="/nodejs/basics/02-yarn.html">
        02-Yarn入门
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> </main> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.8afe0fb5.js" defer></script><script src="/assets/js/3.abed040f.js" defer></script><script src="/assets/js/21.74438e50.js" defer></script>
  </body>
</html>