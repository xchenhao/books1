<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>存储引擎类问题 | 不可思议</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="xchenhao.gitee.io">
    <link rel="preload" href="/assets/css/0.styles.dcdd4981.css" as="style"><link rel="preload" href="/assets/js/app.1006bb4e.js" as="script"><link rel="preload" href="/assets/js/3.ecb1f808.js" as="script"><link rel="preload" href="/assets/js/8.de6f9e5c.js" as="script"><link rel="prefetch" href="/assets/js/10.839e68ba.js"><link rel="prefetch" href="/assets/js/11.fc80baa0.js"><link rel="prefetch" href="/assets/js/12.589f9fd7.js"><link rel="prefetch" href="/assets/js/13.05c79365.js"><link rel="prefetch" href="/assets/js/14.3f40d575.js"><link rel="prefetch" href="/assets/js/15.83ad4380.js"><link rel="prefetch" href="/assets/js/16.d6ca58c3.js"><link rel="prefetch" href="/assets/js/17.99f7357b.js"><link rel="prefetch" href="/assets/js/18.36262359.js"><link rel="prefetch" href="/assets/js/19.5dcf3e21.js"><link rel="prefetch" href="/assets/js/20.a99b697c.js"><link rel="prefetch" href="/assets/js/21.30c881d7.js"><link rel="prefetch" href="/assets/js/22.f40c1f7b.js"><link rel="prefetch" href="/assets/js/23.856941a8.js"><link rel="prefetch" href="/assets/js/24.60b33392.js"><link rel="prefetch" href="/assets/js/25.29f87303.js"><link rel="prefetch" href="/assets/js/26.d9e16ac7.js"><link rel="prefetch" href="/assets/js/27.d1d16327.js"><link rel="prefetch" href="/assets/js/28.aaf2400b.js"><link rel="prefetch" href="/assets/js/29.0a455a29.js"><link rel="prefetch" href="/assets/js/30.b90ce8de.js"><link rel="prefetch" href="/assets/js/31.8341ab32.js"><link rel="prefetch" href="/assets/js/32.a94fcf64.js"><link rel="prefetch" href="/assets/js/33.bb3d7b42.js"><link rel="prefetch" href="/assets/js/34.438344c9.js"><link rel="prefetch" href="/assets/js/35.c8b584ab.js"><link rel="prefetch" href="/assets/js/36.50f683dc.js"><link rel="prefetch" href="/assets/js/37.245d64dd.js"><link rel="prefetch" href="/assets/js/38.6d59a42e.js"><link rel="prefetch" href="/assets/js/39.7ddd8db3.js"><link rel="prefetch" href="/assets/js/4.bd7a8752.js"><link rel="prefetch" href="/assets/js/40.47625021.js"><link rel="prefetch" href="/assets/js/41.c423587d.js"><link rel="prefetch" href="/assets/js/42.dd2632a5.js"><link rel="prefetch" href="/assets/js/43.c6e6b740.js"><link rel="prefetch" href="/assets/js/44.83408d66.js"><link rel="prefetch" href="/assets/js/45.58439efe.js"><link rel="prefetch" href="/assets/js/46.2abb227b.js"><link rel="prefetch" href="/assets/js/47.f8697add.js"><link rel="prefetch" href="/assets/js/48.1f8e7827.js"><link rel="prefetch" href="/assets/js/49.e1d50013.js"><link rel="prefetch" href="/assets/js/5.2e521b8e.js"><link rel="prefetch" href="/assets/js/50.de0cdf28.js"><link rel="prefetch" href="/assets/js/51.01e44d38.js"><link rel="prefetch" href="/assets/js/52.199f46fb.js"><link rel="prefetch" href="/assets/js/53.3da97659.js"><link rel="prefetch" href="/assets/js/54.5e34d71e.js"><link rel="prefetch" href="/assets/js/55.dc502682.js"><link rel="prefetch" href="/assets/js/6.be562cc9.js"><link rel="prefetch" href="/assets/js/7.d91fc515.js"><link rel="prefetch" href="/assets/js/9.7b7214cf.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.ed09d42e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.dcdd4981.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="sidebar-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="/" class="router-link-active no-logo home-link"><!----> <span class="site-name">不可思议</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          数据库
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          语言
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <!----></nav></div></div> <!----></header> <aside class="sidebar"><!----> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>MySQL</span> <span class="arrow down"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mysql/note1.html" title="MySQL 笔记 1" class="sidebar-link">MySQL 笔记 1</a></li><li><a href="/mysql/about_version.html" title="版本类问题" class="sidebar-link">版本类问题</a></li><li><a href="/mysql/about_user.html" title="用户管理类问题" class="sidebar-link">用户管理类问题</a></li><li><a href="/mysql/about_config.html" title="服务器配置类问题" class="sidebar-link">服务器配置类问题</a></li><li><a href="/mysql/about_log.html" title="日志类问题" class="sidebar-link">日志类问题</a></li><li><a href="/mysql/about_engine.html" aria-current="page" title="存储引擎类问题" class="active sidebar-link">存储引擎类问题</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Shell</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node.js</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其它</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><a href="/books-note.html" title="读书笔记" class="sidebar-link">读书笔记</a></li><li><a href="/update_log.html" title="更新记录" class="sidebar-link">更新记录</a></li></ul></aside> <main class="page"> <div class="theme-antdocs-content content__default"><h3 id="存储引擎类问题"><a href="#存储引擎类问题" class="header-anchor">#</a> 存储引擎类问题</h3> <ol><li><p>说一说你了解的MySQL存储引擎及其适用场景</p></li> <li><p>在什么情况下Innodb无法在线修改表结构？</p></li> <li><p>在无法进行在线修改表结构的情况下，要如何操作？</p></li> <li><p>InnoDB是如何实现事务的？</p></li> <li><p>Innodb读操作是否会阻塞写操作？</p></li></ol> <ul><li><p>常用的MySQL存储引擎及使用场景</p> <p>知识点</p> <ul><li><p>MySQL常用的存储引擎</p> <table><thead><tr><th>引擎名称</th> <th>事务</th> <th>说明</th></tr></thead> <tbody><tr><td>MYISAM</td> <td>N</td> <td>MySQL5.6之前的默认引擎，最常用的非事务型存储引擎</td></tr> <tr><td>CSV</td> <td>N</td> <td>以CSV格式存储的非事务型存储引擎</td></tr> <tr><td>Archive</td> <td>N</td> <td>只允许查询和新增数据而不允许修改的非事务型存储引擎</td></tr> <tr><td>Memory</td> <td>N</td> <td>是一种易失性非事务型存储引擎</td></tr> <tr><td>INNODB</td> <td>Y</td> <td>最常用的事务型存储引擎</td></tr> <tr><td>NDB</td> <td>Y</td> <td>MySQL集群所使用的内存型事务存储引擎</td></tr></tbody></table> <ul><li><p>MyISAM 的特点</p> <ol><li><p>非事务型存储引擎</p></li> <li><p>以堆表方式存储</p></li> <li><p>使用表级锁</p></li> <li><p>支持Btree索引，空间索引，全文索引</p></li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code>mysql<span class="token operator">&gt;</span> use stock<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> create table myIsam<span class="token punctuation">(</span>id int, c1 varchar<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">))</span> <span class="token assign-left variable">engine</span><span class="token operator">=</span>myisam<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> check table myIsam<span class="token punctuation">;</span>
----------------------------------------
<span class="token operator">|</span>Table       <span class="token operator">|</span>Op     <span class="token operator">|</span>Msg_Type<span class="token operator">|</span>Msg_text<span class="token operator">|</span>
<span class="token operator">|</span>stock.myIsam<span class="token operator">|</span>check  <span class="token operator">|</span>status  <span class="token operator">|</span>OK      <span class="token operator">|</span>
----------------------------------------
mysql<span class="token operator">&gt;</span> repair table myIsam<span class="token punctuation">;</span>
----------------------------------------
<span class="token operator">|</span>Table       <span class="token operator">|</span>Op     <span class="token operator">|</span>Msg_Type<span class="token operator">|</span>Msg_text<span class="token operator">|</span>
<span class="token operator">|</span>stock.myIsam<span class="token operator">|</span>repair <span class="token operator">|</span>status  <span class="token operator">|</span>OK      <span class="token operator">|</span>
----------------------------------------
</code></pre></div><p><img src="/assets/img/image-20201205201011264.ee9154bc.png" alt="image-20201205201011264"></p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ myisampack --help <span class="token comment"># 可对 myisam 表压缩</span>
$ myisampack -b -f myIsam
Compressing myIsam. MYD: <span class="token punctuation">(</span><span class="token number">0</span> records<span class="token punctuation">)</span>
Calculating statistics
-Compressing <span class="token function">file</span> 
Empty <span class="token function">file</span> saved <span class="token keyword">in</span> compressed <span class="token function">format</span>
$ <span class="token function">ls</span> -lh myIsam*
-rw-r----- <span class="token number">1</span> mysql mysql <span class="token number">50</span>   Aug <span class="token number">30</span> <span class="token number">21</span>:33 myIsam. MYD
-rw-r----- <span class="token number">1</span> mysql mysql <span class="token number">1</span>.0K Aug <span class="token number">30</span> <span class="token number">21</span>:33 myIsam. MYT
-rw-r------1 mysql mysql <span class="token number">0</span>    Aug <span class="token number">30</span> <span class="token number">21</span>:33 myIsam.OLD
-rw-r----- <span class="token number">1</span> mysql mysql <span class="token number">2</span>.2K Aug <span class="token number">30</span> <span class="token number">21</span>:33 myIsam_373.sdi
</code></pre></div><p>适用场景</p> <ul><li>读操作远远大于写操作的场景</li> <li>不需要使用事务的场景</li></ul></li> <li><p>CSV 引擎的特点</p> <ol><li>非事务型存储引擎</li> <li>数据以CSV格式存储</li> <li>所有列都不能为NULL</li> <li>不支持索引</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code>mysql<span class="token operator">&gt;</span> create table mycsv<span class="token punctuation">(</span>id int, c1 varchar<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>,c2 char <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">))</span> <span class="token assign-left variable">engine</span><span class="token operator">=</span>csv<span class="token punctuation">;</span>
ERROR <span class="token number">1178</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span>: The storage engine <span class="token keyword">for</span> the table doesn<span class="token string">'t support nuilable columns
mysql&gt; create tabie mycsv(id int not null,c1 varchar(20) not nul1 ,c2 char(20) not null) engine=csV;
Query ok, o rows affected (0.02 sec)
mysql&gt; insert into mycsv values(1，'</span>aa<span class="token string">'，'</span>bb<span class="token string">'),(2，'</span>cc<span class="token string">'，'</span><span class="token function">dd</span><span class="token string">');


[root@MysQL-06 stock]# 1s-1h mycsv*
-rw-r-- 1 mysql mysql 35   Aug 30 21:43 mycsv.CSM
-rw-r-- 1 mysql mysql 24   Aug 30 21:43 mycsv.CSV
-rw-r-- 1 mysql mysql 3.OK Aug 30 21:42 mycsv_375.sdi
[root@MysQL-06 stock] # more mycsv.CSV
1,&quot;aa&quot;, &quot;bb&quot;
2, &quot;cc&quot;,&quot;dd&quot;
[root@MysQL-06 stock] # echo '</span><span class="token number">3</span>,<span class="token string">&quot;dd&quot;</span>,<span class="token string">&quot;ee&quot;</span>' <span class="token operator">&gt;&gt;</span> mycsv.CSV
<span class="token punctuation">[</span>root@MysQL-06 stock<span class="token punctuation">]</span> <span class="token comment"># more mycsv.CSV</span>
<span class="token number">1</span>,<span class="token string">&quot;aa&quot;</span>,<span class="token string">&quot;bb&quot;</span>
<span class="token number">2</span>,<span class="token string">&quot;cc&quot;</span>,<span class="token string">&quot;dd&quot;</span>
<span class="token number">3</span>,<span class="token string">&quot;dd&quot;</span>,<span class="token string">&quot;ee&quot;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> * from mycsv<span class="token punctuation">;</span>
<span class="token operator">|</span>----<span class="token operator">|</span>----<span class="token operator">|</span>----<span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span> <span class="token operator">|</span> c1 <span class="token operator">|</span> c2 <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1</span>  <span class="token operator">|</span> aa <span class="token operator">|</span> bb <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span>  <span class="token operator">|</span> cc <span class="token operator">|</span> <span class="token keyword">do</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3</span>  <span class="token operator">|</span> <span class="token function">dd</span> <span class="token operator">|</span> ee <span class="token operator">|</span>
<span class="token operator">|</span>----<span class="token operator">|</span>----<span class="token operator">|</span>----<span class="token operator">|</span>
<span class="token number">3</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
mysql<span class="token operator">&gt;</span> create index idx_id on mycsv<span class="token punctuation">(</span>id<span class="token punctuation">)</span>
ERROR <span class="token number">1069</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span>: Too many keys specified<span class="token punctuation">;</span> max o keys allowed
</code></pre></div><p>适用场景</p> <ul><li>做为数据交换的中间表使用</li></ul></li></ul> <ul><li><p>Archive 引擎的特点</p> <ol><li>非事务型存储引擎</li> <li>表数据使用zlib压缩</li> <li>只支持Insert和Select</li> <li>只允许在自增ID上建立索引</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code>mysql<span class="token operator">&gt;</span> create table myarchive<span class="token punctuation">(</span>id int auto_increment not null,c1 varchar<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>, c2 char<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>,key <span class="token punctuation">(</span>id<span class="token punctuation">))</span>engine<span class="token operator">=</span>archive<span class="token punctuation">;</span>
</code></pre></div><p><img src="/assets/img/image-20201205205142872.9c6fa174.png" alt="image-20201205205142872"></p> <div class="language-sh extra-class"><pre class="language-sh"><code>mysql<span class="token operator">&gt;</span> insert into myarchive<span class="token punctuation">(</span>c1, c2<span class="token punctuation">)</span> values<span class="token punctuation">(</span><span class="token string">'aa'</span>, <span class="token string">'bb'</span><span class="token punctuation">)</span>.<span class="token punctuation">(</span><span class="token string">'cc'</span>, <span class="token string">'dd'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> delete from myarchive where <span class="token function">id</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
ERROR <span class="token number">1031</span> <span class="token punctuation">(</span>HY000<span class="token punctuation">)</span>: Table storage engine <span class="token keyword">for</span> <span class="token string">'myarchive'</span> doesn<span class="token string">'t have this option
mysql&gt; updąte myarchive set c1='</span>ddd<span class="token string">' where id=1;
ERROR 1031 (HYO00): Table storage engine for '</span> myarchive<span class="token string">' doesn'</span>t have this option
mysql<span class="token operator">&gt;</span> create index idx_cl on myarchive<span class="token punctuation">(</span>c1<span class="token punctuation">)</span><span class="token punctuation">;</span> 
ERROR <span class="token number">1069</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span>: Too many keys specified<span class="token punctuation">;</span> max <span class="token number">1</span> keys allowed
</code></pre></div><p>适用场景</p> <ul><li>日志和数据采集类应用</li> <li>数据归档存储</li></ul></li> <li><p>Memory 引擎的特点</p> <ol><li>非事务型存储引擎</li> <li>数据保存在内存中</li> <li>所有字段长度固定</li> <li>支持 Btree 和 Hash 索引</li></ol> <p>适用场景</p> <ul><li>用于缓存字典映射表</li> <li>缓存周期性分析数据</li></ul></li> <li><p>Innodb 引擎的特点</p> <ol><li>事务型存储引擎支持ACID</li> <li>数据按主键聚集存储</li> <li>支持行级锁及MVCC</li> <li>支持Btree和自适应Hash索引</li> <li>支持全文和空间索引</li></ol> <p>适用场景：大多数 OLTP 场景</p></li> <li><p>NDB 引擎的特点</p> <ol><li>事务型存储引擎</li> <li>数据存储在内存中</li> <li>支持行级锁</li> <li>支持高可用集群</li> <li>支持Ttree索引</li></ol> <p>适用场景：需要数据完全同步的高可用场景</p></li></ul></li> <li><p>在什么情况下INNODB无法在线修改表
知识点</p> <ul><li><p>Innodb不支持在线修改表结构的场景</p> <table><thead><tr><th>操作</th> <th>语法</th></tr></thead> <tbody><tr><td>加全文索引</td> <td>CREATE FULLTEXT INDEX name ON table(column);</td></tr> <tr><td>加空间索引</td> <td>ALTER TABLE geom ADD SPATIAL INDEX(g)</td></tr> <tr><td>删除主键</td> <td>ALTER TABLE tbl name DROP PRIMARY KEY</td></tr> <tr><td>增加自增列</td> <td>alter table t add column id int auto increment not null primary key</td></tr> <tr><td>修改列类型</td> <td>ALTER TABLE tbl name CHANGE c1 c1 NEW TYPE</td></tr> <tr><td>改表字符集</td> <td>ALTER TABLE tbl name CHARACTER SET = charset name</td></tr></tbody></table> <ul><li><p>在线 DDL 存在的问题</p> <p>有部分语句不支持在线DDL
长时间的DDL操作会引起严重的主从延迟
无法对DDL操作进行资源限制</p></li> <li><p>如何更安全的执行DDL？</p> <p>pt-online-schema-change[OPTIONS]DSN</p> <div class="language-sh extra-class"><pre class="language-sh"><code>mysql<span class="token operator">&gt;</span> alter table stock <span class="token function">add</span> <span class="token function">column</span> modified_time timestamp<span class="token punctuation">\</span>c

$ pt-online-schema-change --alter <span class="token string">&quot;add column modified_time timestamp&quot;</span> --execute <span class="token assign-left variable">D</span><span class="token operator">=</span>stock,t<span class="token operator">=</span>stock,u<span class="token operator">=</span>dba,p<span class="token operator">=</span><span class="token number">123456</span>
</code></pre></div></li></ul></li> <li><p>Innodb 是如何实现事务？</p> <p>知识点</p> <ul><li><p>什么是事务？</p> <table><thead><tr><th>特征</th> <th>说明</th></tr></thead> <tbody><tr><td>原子性（A）</td> <td>一个事务中的所有操作，要么全部完成，要么全部不完成，不会结束在中间某个环节。</td></tr> <tr><td>一致性（C）</td> <td>在事务开始之前和事务结束以后，数据库的完整性没有被破坏。</td></tr> <tr><td>隔离性（I）</td> <td>事务的隔离性要求每个读写事务的对象与其它事务的操作对象能相互分离，即该事务提交前对其它事务都不可见。</td></tr> <tr><td>持久性（D）</td> <td>事务一旦提交了，其结果就是永久性的，就算发生了宕机等事故数据库也能将数据恢复。</td></tr></tbody></table> <p>事务实现方式</p> <table><thead><tr><th>特征</th> <th>Innodb 实现方式</th></tr></thead> <tbody><tr><td>原子性（A）</td> <td>回滚日志（Undo log）：用于记录数据修改前的状态</td></tr> <tr><td>一致性（C）</td> <td>重作日志（Redo Log）：用于记录数据修改后的状态</td></tr> <tr><td>隔离性（I）</td> <td>锁：用于资源隔离，分为共享锁和排它锁</td></tr> <tr><td>持久性（D）</td> <td>重作日志（Redo log）+回滚日志（Undo Log）</td></tr></tbody></table> <p><img src="/assets/img/image-20201212151159149.c7a5626d.png" alt="image-20201212151159149"><img src="/assets/img/image-20201212151227030.ae038cbd.png" alt="image-20201212151227030"></p></li> <li><p>Redo log 和 undo log 在事务实现中的作用</p></li> <li><p>Innodb 读是否会阻塞写？</p> <p>读写应该相互阻塞吗？</p> <ul><li><p>查询需要对资源加共享锁（S）</p></li> <li><p>数据修改需要对资源加排它锁（x）</p> <table><thead><tr><th></th> <th>排它锁</th> <th>共享锁</th></tr></thead> <tbody><tr><td>排它锁</td> <td>不兼容</td> <td>不兼容</td></tr> <tr><td>共享锁</td> <td>不兼容</td> <td>兼容</td></tr></tbody></table> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># session-1</span>
mysql<span class="token operator">&gt;</span> begin<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> * from stock.stock where <span class="token function">id</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token function">id</span>   product_id  category_id  warehouse_id  count  modified_time
<span class="token number">1</span>    <span class="token number">2030</span>        <span class="token number">9</span>            <span class="token number">1</span>             <span class="token number">10</span>     <span class="token number">2018</span>-08-31 09:51:22

<span class="token comment"># session-2</span>
mysql<span class="token operator">&gt;</span> begin<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> update stock.stock <span class="token builtin class-name">set</span> <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">30</span> where <span class="token function">id</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment"># session-1</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> * from stock.stock where <span class="token function">id</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment"># 查询没有被阻塞</span>
<span class="token function">id</span>   product_id  category_id  warehouse_id  count  modified_time
<span class="token number">1</span>    <span class="token number">2030</span>        <span class="token number">9</span>            <span class="token number">1</span>             <span class="token number">10</span>     <span class="token number">2018</span>-08-31 09:51:22
</code></pre></div><p>知识点：InnoDB MVCC 的实现方式</p> <p><img src="/assets/img/image-20201212152524212.9025a0a6.png" alt="image-20201212152524212"></p></li></ul></li></ul></li> <li><p>如何更安全的在线修改表结构</p></li></ul></li> <li><p>各种常见存储引擎的使用场景</p></li></ul></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/12/2020, 3:33:19 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/mysql/about_log.html" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        日志类问题
      </a></span> <span class="next"><a href="/Python.html">
        Python 基础
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> </main> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1006bb4e.js" defer></script><script src="/assets/js/3.ecb1f808.js" defer></script><script src="/assets/js/8.de6f9e5c.js" defer></script>
  </body>
</html>